<!DOCTYPE html>
<html>
<head>
    <title>Call Trace: call_1753232555342</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <style>
        body { font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica Neue', Arial, sans-serif; font-size: 14px; line-height: 1.4; margin: 20px; background-color: #f8f9fa; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); position: relative; }
        .header h1 { margin: 0 0 10px 0; }
        .export-btn { position: absolute; top: 20px; right: 20px; background-color: #ffffff; color: #764ba2; border: 1px solid #764ba2; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: all 0.2s; }
        .export-btn:hover { background-color: #f1eafa; }
        .trace-container { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); overflow: hidden; padding: 10px; }
        .call-node { margin: 4px 0; border-radius: 6px; overflow: hidden; }
        .call-header { padding: 8px 12px; cursor: pointer; border: 1px solid #dee2e6; border-radius: 6px; display: flex; align-items: center; transition: all 0.2s; background: linear-gradient(90deg, #ffffff 0%, #f8f9fa 100%); }
        .call-header:hover { background: linear-gradient(90deg, #e9ecef 0%, #f8f9fa 100%); border-color: #adb5bd; }
        .toggle-icon { margin-right: 8px; font-weight: bold; color: #6c757d; width: 12px; text-align: center; font-family: 'Courier New', monospace; }
        .function-name { font-weight: bold; color: #495057; font-family: 'Courier New', monospace; }
        .method-indicator { color: #6f42c1; font-size: 12px; margin-right: 4px; font-family: 'Courier New', monospace; }
        .file-info { color: #6c757d; font-size: 12px; margin-left: 8px; font-family: 'Courier New', monospace;}
        .thread-info { font-size: 11px; color: #17a2b8; font-weight: bold; margin-left: auto; padding-left: 16px; }
        .call-content { display: none; border: 1px solid #dee2e6; border-top: none; border-radius: 0 0 6px 6px; background-color: #ffffff; }
        .call-content.show { display: block; }
        .call-info { padding: 12px; background-color: #fdfdfd; }
        .call-children { padding: 8px 8px 8px 20px; background-color: #ffffff; border-left: 3px solid #e9ecef; margin-left: 12px; }
        .args-section, .return-section, .source-section { margin-top: 12px; }
        .section-title { font-weight: bold; color: #343a40; margin-bottom: 0; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
        .args-section .section-title { margin-bottom: 4px; }
        .args-list { background: white; border: 1px solid #dee2e6; border-radius: 4px; padding: 8px; max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px; }
        .return-value { background: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 4px; padding: 12px; font-family: 'Courier New', monospace; color: #0056b3; font-size: 12px; white-space: pre-wrap; word-wrap: break-word; }
        .source-toggle { background: #6c757d; color: white; border: none; padding: 4px 8px; font-size: 11px; border-radius: 4px; cursor: pointer; }
        .source-container { display: none; margin-top: 8px; border: 1px solid #ced4da; border-radius: 4px; max-height: 500px; overflow: auto; }
        .source-container pre { margin: 0; }
        .comment-section { margin-bottom: 12px; }
        .comment-header { display: flex; align-items: center; margin-bottom: 5px; }
        .comment-header .section-title { margin-right: 8px; }
        .comment-toggle-edit-btn, .comment-save-btn { background-color: #f8f9fa; border: 1px solid #dee2e6; color: #495057; padding: 2px 8px; font-size: 11px; border-radius: 4px; cursor: pointer; }
        .comment-toggle-edit-btn:hover, .comment-save-btn:hover { background-color: #e9ecef; }
        .comment-content .comment-output { padding: 10px; background-color: #f8f9fa; border-radius: 4px; border: 1px solid #e9ecef; min-height: 20px; word-wrap: break-word; }
        .comment-content .comment-output pre { white-space: pre-wrap; }
        .comment-edit-controls { display: none; margin-top: 8px; }
        .comment-edit-controls .comment-input { width: 100%; box-sizing: border-box; min-height: 80px; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-family: inherit; font-size: 14px; }
        .comment-edit-controls .comment-save-btn { margin-top: 8px; }
        .comment-save-btn { display: none; }
        .comment-section:not([data-editing="true"]) .comment-output:empty { display: none; }
        .comment-section[data-editing="true"] .comment-edit-controls { display: block; }
        .comment-section[data-editing="true"] .comment-toggle-edit-btn { display: none; }
        .comment-section[data-editing="true"] .comment-save-btn { display: inline-block; }
        .comment-section[data-editing="true"] .comment-output { border-top: 1px dashed #ccc; margin-top: 10px; padding-top: 10px; background-color: #fff; }
        .trace-image {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: block;
            margin: 8px 0;
        }
        
        .trace-image:not([data-expanded="true"]) {
            max-width: 172px;
            max-height: 172px;
            width: auto;
            height: auto;
        }
        
        .trace-image[data-expanded="true"] {
            max-width: 768px;
            max-height: 768px;
            width: auto;
            height: auto;
        }
        
        .trace-image:hover {
            border-color: #999;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .depth-0 > .call-header { border-left: 4px solid #dc3545; } .depth-1 > .call-header { border-left: 4px solid #fd7e14; }
        .depth-2 > .call-header { border-left: 4px solid #ffc107; } .depth-3 > .call-header { border-left: 4px solid #28a745; }
        .depth-4 > .call-header { border-left: 4px solid #007bff; } .depth-5 > .call-header { border-left: 4px solid #6f42c1; }
    </style>
</head>
<body data-request-id="call_1753232555342">
    <div class="header">
        <h1>üîç Function Call Trace</h1>
        <p>Request ID: call_1753232555342</p>
        <p>Total calls captured: 39</p>
        <button class="export-btn" onclick="exportFullHTML()">Export Trace</button>
    </div>
    <div class="trace-container">
        
        
            
                
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-0" id="node-0">
        <div class="call-header" onclick="toggleCall(0)">
            <span class="toggle-icon" id="icon-0">‚ñ∂</span>
            
        <span class="function-name">predict()</span>
    
            
        <span class="file-info">[server.py:40]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-0" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-0" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(0)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(0)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-0"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-0" oninput="previewComment(0)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            No arguments
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">flask.wrappers.Response(response=[b&#x27;[{&quot;box&quot;:[0.15648148148148147,0.4296875,0.7870370370370371,0.7510416666666667],&quot;class_name&quot;:&quot;CARDBOARD&quot;,&quot;score&quot;:0.9619330167770386,&quot;weight&quot;:325.3363279464092},{&quot;box&quot;:[0.2574074074074074,0.4828125,0.2935185185185185,0.5067708333333333],&quot;class_name&quot;:&quot;OTHER_MATERIAL&quot;,&quot;score&quot;:0.4542120397090912}]\n&#x27;], status=&#x27;200 OK&#x27;, headers=werkzeug.datastructures.headers.Headers(), mimetype=&#x27;application/json&#x27;, content_type=&#x27;application/json&#x27;, direct_passthrough=False)</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(0)">Show/Hide</button>
                <div class="source-container" id="source-0">
                    <pre class="language-python" tabindex="0"><code class="language-python">    @app.route(&#34;/predict&#34;, methods=[&#34;POST&#34;])
    @trace_calls(request_id_key=&#34;s3_uri&#34;, output_dir=TRACE_OUTPUT_DIR)
    def predict() -&gt; Any:
        &#34;&#34;&#34;Handle prediction requests for an image.

        Returns:
            JSON response with prediction results
        &#34;&#34;&#34;
        start_time = time.perf_counter()

        if not request.json or &#34;s3_uri&#34; not in request.json:
            elapsed_ms = (time.perf_counter() - start_time) * 1000
            logging.warning(
                f&#34;Request failed (missing s3_uri) - Duration: {elapsed_ms:.2f}ms&#34;
            )
            return (
                jsonify({&#34;error&#34;: &#34;Missing &#39;s3_uri&#39; in request JSON body.&#34;}),
                400,
            )

        s3_uri = request.json[&#34;s3_uri&#34;]
        logging.info(f&#34;Processing prediction request for: {s3_uri}&#34;)

        try:
            image = machine_learning.image_ops.read_image(s3_uri)

            inference_start = time.perf_counter()

            # run these puppies in parallel!
            bbox_future = executor.submit(
                run_inference_for_images_in_memory,
                cardboard_model_executor,
                [image],
                [s3_uri],
            )

            segmentation_future = executor.submit(
                run_inference_for_images_in_memory,
                box_base_model_executor,
                [image],
                [s3_uri],
            )

            bounding_box_inference_results = bbox_future.result()
            box_base_segmentation_inference_results = segmentation_future.result()

            inference_elapsed = time.perf_counter() - inference_start

            weight_start = time.perf_counter()
            weight_df = weight_model.run_weight_inference_for_dataframes(
                bounding_box_inference_results,
                box_base_segmentation_inference_results,
            )
            weight_elapsed = time.perf_counter() - weight_start

            id_to_weight = dict(zip(weight_df.id, weight_df.weight))

            results = []
            for _, row in bounding_box_inference_results.iterrows():
                result = {
                    &#34;box&#34;: [row.ymin, row.xmin, row.ymax, row.xmax],
                    &#34;class_name&#34;: row.class_name,
                    &#34;score&#34;: row.score,
                }
                weight = id_to_weight.get(row.id)
                if weight:
                    result[&#34;weight&#34;] = weight

                results.append(result)

            total_elapsed_ms = (time.perf_counter() - start_time) * 1000
            num_detections = len(results)

            logging.info(
                f&#34;Request completed successfully - &#34;
                f&#34;S3 URI: {s3_uri}, &#34;
                f&#34;Detections: {num_detections}, &#34;
                f&#34;Total Duration: {total_elapsed_ms:.2f}ms, &#34;
                f&#34;Breakdown: inference={inference_elapsed * 1000:.2f}ms, &#34;
                f&#34;weight={weight_elapsed * 1000:.2f}ms&#34;
            )

            return jsonify(results)

        except Exception as e:
            elapsed_ms = (time.perf_counter() - start_time) * 1000
            error_trace = traceback.format_exc()
            logging.error(
                f&#34;Request failed with error - &#34;
                f&#34;S3 URI: {s3_uri}, &#34;
                f&#34;Duration: {elapsed_ms:.2f}ms, &#34;
                f&#34;Error: {e}\n{error_trace}&#34;
            )
            return jsonify({&#34;error&#34;: str(e), &#34;traceback&#34;: error_trace}), 500
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-1" id="node-1">
        <div class="call-header" onclick="toggleCall(1)">
            <span class="toggle-icon" id="icon-1">‚ñ∂</span>
            
        <span class="function-name">image = machine_learning.image_ops.read_image(s3_uri)</span>
    
            
        <span class="file-info">[image_ops.py:64]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-1" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-1" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(1)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(1)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-1"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-1" oninput="previewComment(1)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">filepath:</span> <span style="color: rgb(0, 86, 179);">&#x27;s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg&#x27;</span></div>
            
                <div><span style="color: #505050;">as_gray:</span> <span style="color: rgb(0, 86, 179);">False</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value"><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_1.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_1"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_1')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(1)">Show/Hide</button>
                <div class="source-container" id="source-1">
                    <pre class="language-python" tabindex="0"><code class="language-python">def read_image(filepath: str, as_gray: bool = False) -&gt; RGBImage:
    &#34;&#34;&#34;Read an image from local disk or S3.

    Arguments:
        filepath: Where to read the image from.
        as_gray: If True, reads the image in grayscale mode. Defaults to False.

    Returns:
        A numpy array with the image data
            - The array is shaped (height, width, channels) where channels is
                length 3 for RGB and length 1 for grayscale.
            - The array is of type uint8.
    &#34;&#34;&#34;
    mode = &#34;L&#34; if as_gray else &#34;RGB&#34;
    if filepath.startswith(&#34;s3://&#34;):
        return read_image_from_s3(filepath, mode)
    return read_image_from_local_disk(filepath, mode)
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-2" id="node-2">
        <div class="call-header" onclick="toggleCall(2)">
            <span class="toggle-icon" id="icon-2">‚ñ∂</span>
            
        <span class="function-name">return read_image_from_s3(filepath, mode)</span>
    
            
        <span class="file-info">[image_ops.py:37]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-2" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-2" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(2)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(2)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-2"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-2" oninput="previewComment(2)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">s3_uri:</span> <span style="color: rgb(0, 86, 179);">&#x27;s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg&#x27;</span></div>
            
                <div><span style="color: #505050;">mode:</span> <span style="color: rgb(0, 86, 179);">&#x27;RGB&#x27;</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value"><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_0.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_0"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_0')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(2)">Show/Hide</button>
                <div class="source-container" id="source-2">
                    <pre class="language-python" tabindex="0"><code class="language-python">def read_image_from_s3(s3_uri: str, mode: str) -&gt; RGBImage:
    &#34;&#34;&#34;Read an image from S3 using boto.

    Arguments:
        s3_uri: The s3 URI (path with bucket) to read the image from.
        mode: The mode to read the image in (e.g. &#34;L&#34; for grayscale).

    Returns:
        A numpy array representing an image.
            - The array is shaped (height, width, channels) where channels is
                length 3 for RGB and length 1 for grayscale.
            - The array is of type uint8.
    &#34;&#34;&#34;
    url = urlparse(s3_uri)
    image_bucket = url.netloc
    image_key = url.path.lstrip(&#34;/&#34;)

    # Load the jpg image into memory
    response = s3.get_object(
        Bucket=image_bucket,
        Key=image_key,
    )
    image_bytes = response[&#34;Body&#34;].read()
    image = imageio.v3.imread(image_bytes, mode=mode)
    return image
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-1" id="node-5">
        <div class="call-header" onclick="toggleCall(5)">
            <span class="toggle-icon" id="icon-5">‚ñ∂</span>
            
            <span class="method-indicator">[Future]</span> 
        <span class="function-name">bounding_box_inference_results = bbox_future.result()</span>
    
        
            
        <span class="file-info">[_base.py:83]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-5" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-5" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(5)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(5)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-5"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-5" oninput="previewComment(5)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">self:</span> <span style="color: rgb(0, 86, 179);">concurrent.futures._base.Future()</span></div>
            
                <div><span style="color: #505050;">timeout:</span> <span style="color: rgb(0, 86, 179);">None</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (2√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.48,0.26,0.51,0.29,0.45,OTHER_MATERIAL,1920,1080,0.0,be3b4e16-1bc8-47e4-8e95-d7ec91da92c7
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_2.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_2"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_2')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(5)">Show/Hide</button>
                <div class="source-container" id="source-5">
                    <pre class="language-python" tabindex="0"><code class="language-python">    def result(self, timeout=None):
        &#34;&#34;&#34;Return the result of the call that the future represents.

        Args:
            timeout: The number of seconds to wait for the result if the future
                isn&#39;t done. If None, then there is no limit on the wait time.

        Returns:
            The result of the call that the future represents.

        Raises:
            CancelledError: If the future was cancelled.
            TimeoutError: If the future didn&#39;t finish executing before the given
                timeout.
            Exception: If the call raised then that exception will be raised.
        &#34;&#34;&#34;
        try:
            with self._condition:
                if self._state in [CANCELLED, CANCELLED_AND_NOTIFIED]:
                    raise CancelledError()
                elif self._state == FINISHED:
                    return self.__get_result()

                self._condition.wait(timeout)

                if self._state in [CANCELLED, CANCELLED_AND_NOTIFIED]:
                    raise CancelledError()
                elif self._state == FINISHED:
                    return self.__get_result()
                else:
                    raise TimeoutError()
        finally:
            # Break a reference cycle with the exception in self._exception
            self = None
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-1" id="node-7">
        <div class="call-header" onclick="toggleCall(7)">
            <span class="toggle-icon" id="icon-7">‚ñ∂</span>
            
            <span class="method-indicator">[Future]</span> 
        <span class="function-name">box_base_segmentation_inference_results = segmentation_future.result()</span>
    
        
            
        <span class="file-info">[_base.py:84]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-7" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-7" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(7)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(7)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-7"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-7" oninput="previewComment(7)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">self:</span> <span style="color: rgb(0, 86, 179);">concurrent.futures._base.Future()</span></div>
            
                <div><span style="color: #505050;">timeout:</span> <span style="color: rgb(0, 86, 179);">None</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_3.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_3"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_3')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(7)">Show/Hide</button>
                <div class="source-container" id="source-7">
                    <pre class="language-python" tabindex="0"><code class="language-python">    def result(self, timeout=None):
        &#34;&#34;&#34;Return the result of the call that the future represents.

        Args:
            timeout: The number of seconds to wait for the result if the future
                isn&#39;t done. If None, then there is no limit on the wait time.

        Returns:
            The result of the call that the future represents.

        Raises:
            CancelledError: If the future was cancelled.
            TimeoutError: If the future didn&#39;t finish executing before the given
                timeout.
            Exception: If the call raised then that exception will be raised.
        &#34;&#34;&#34;
        try:
            with self._condition:
                if self._state in [CANCELLED, CANCELLED_AND_NOTIFIED]:
                    raise CancelledError()
                elif self._state == FINISHED:
                    return self.__get_result()

                self._condition.wait(timeout)

                if self._state in [CANCELLED, CANCELLED_AND_NOTIFIED]:
                    raise CancelledError()
                elif self._state == FINISHED:
                    return self.__get_result()
                else:
                    raise TimeoutError()
        finally:
            # Break a reference cycle with the exception in self._exception
            self = None
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-1" id="node-9">
        <div class="call-header" onclick="toggleCall(9)">
            <span class="toggle-icon" id="icon-9">‚ñ∂</span>
            
        <span class="function-name">weight_df = weight_model.run_weight_inference_for_dataframes(bounding_box_inference_results,
                box_base_segmentation_inference_results)</span>
    
            
        <span class="file-info">[model.py:89-92]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-9" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-9" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(9)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(9)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-9"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-9" oninput="previewComment(9)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">cardboard_box_df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.48,0.26,0.51,0.29,0.45,OTHER_MATERIAL,1920,1080,0.0,be3b4e16-1bc8-47e4-8e95-d7ec91da92c7
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_4.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_4"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_4')">
                             </div></span></div>
            
                <div><span style="color: #505050;">box_base_df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_5.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_5"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_5')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (1√ó20) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id,box_length_cm,box_width_cm,box_height_cm,device_id,polygon_coordinates,has_depth_map,surface_area,bbox_area,weight
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245,25.67,28.96,26.59,SCN-011,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,4392.56,0.2,325.34
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_48.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_48"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_48')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(9)">Show/Hide</button>
                <div class="source-container" id="source-9">
                    <pre class="language-python" tabindex="0"><code class="language-python">def run_weight_inference_for_dataframes(
    cardboard_box_df: pd.DataFrame,
    box_base_df: pd.DataFrame,
):
    &#34;&#34;&#34;Run weight inference on cardboard box and box base dataframes.

    Args:
        cardboard_box_df: DataFrame containing cardboard box detections.
        box_base_df: DataFrame containing box base detections.

    Returns:
        DataFrame with computed surface area features and weight estimates.
    &#34;&#34;&#34;
    result_df = compute_surface_area_features_for_dataframes(
        cardboard_box_df, box_base_df
    )
    if not result_df.empty:
        result_df[&#34;weight&#34;] = result_df.apply(
            lambda row: utils.estimate_weight_from_surface_area(
                row.device_id, row.surface_area
            ),
            axis=&#34;columns&#34;,
        )
    return result_df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-2" id="node-10">
        <div class="call-header" onclick="toggleCall(10)">
            <span class="toggle-icon" id="icon-10">‚ñ∂</span>
            
        <span class="function-name">result_df = compute_surface_area_features_for_dataframes(cardboard_box_df, box_base_df)</span>
    
            
        <span class="file-info">[model.py:42-44]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-10" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-10" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(10)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(10)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-10"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-10" oninput="previewComment(10)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">cardboard_box_df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.48,0.26,0.51,0.29,0.45,OTHER_MATERIAL,1920,1080,0.0,be3b4e16-1bc8-47e4-8e95-d7ec91da92c7
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_6.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_6"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_6')">
                             </div></span></div>
            
                <div><span style="color: #505050;">box_base_df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_7.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_7"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_7')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (1√ó19) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id,box_length_cm,box_width_cm,box_height_cm,device_id,polygon_coordinates,has_depth_map,surface_area,bbox_area
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245,25.67,28.96,26.59,SCN-011,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,4392.56,0.2
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_47.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_47"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_47')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(10)">Show/Hide</button>
                <div class="source-container" id="source-10">
                    <pre class="language-python" tabindex="0"><code class="language-python">def compute_surface_area_features_for_dataframes(
    cardboard_box_df: pd.DataFrame,
    box_base_df: pd.DataFrame,
):
    &#34;&#34;&#34;Compute surface area features from cardboard box and box base dataframes.

    Args:
        cardboard_box_df: DataFrame containing cardboard box detections.
        box_base_df: DataFrame containing box base detections.

    Returns:
        DataFrame with computed surface area and bounding box area features.
    &#34;&#34;&#34;
    cardboard_box_df = cardboard_box_df.query(&#39;class_name == &#34;CARDBOARD&#34;&#39;)
    discordant_pairs = machine_learning.dataframe_ops.find_discordant_pairs(
        cardboard_box_df,
        box_base_df,
        iou_threshold=0.05,
    )

    surface_area_features = utils.get_surface_area_features_for_discordant_pairs_df(
        discordant_pairs
    )

    result_df = utils.compute_surface_area_and_bbox_area(
        cardboard_box_df,
        surface_area_features,
    )

    return result_df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-3" id="node-11">
        <div class="call-header" onclick="toggleCall(11)">
            <span class="toggle-icon" id="icon-11">‚ñ∂</span>
            
        <span class="function-name">discordant_pairs = machine_learning.dataframe_ops.find_discordant_pairs(cardboard_box_df,
        box_base_df,
        iou_threshold=0.05)</span>
    
            
        <span class="file-info">[dataframe_ops.py:121-125]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-11" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-11" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(11)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(11)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-11"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-11" oninput="previewComment(11)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">alpha_df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_8.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_8"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_8')">
                             </div></span></div>
            
                <div><span style="color: #505050;">beta_df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_9.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_9"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_9')">
                             </div></span></div>
            
                <div><span style="color: #505050;">label_model_name:</span> <span style="color: rgb(0, 86, 179);">&#x27;alpha&#x27;</span></div>
            
                <div><span style="color: #505050;">inference_model_name:</span> <span style="color: rgb(0, 86, 179);">&#x27;beta&#x27;</span></div>
            
                <div><span style="color: #505050;">iou_threshold:</span> <span style="color: rgb(0, 86, 179);">0.05</span></div>
            
                <div><span style="color: #505050;">allow_multi_matching:</span> <span style="color: rgb(0, 86, 179);">False</span></div>
            
                <div><span style="color: #505050;">parallel:</span> <span style="color: rgb(0, 86, 179);">True</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (3√ó15) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,class_name,xmin,ymin,xmax,ymax,area,id,image_height,image_width,score,model_name,polygon_coordinates,is_segmentation,group_id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,CARDBOARD,0.43,0.16,0.75,0.79,0.2,be2b443a-373a-4f53-85ea-4109f113c245,1080,1920,0.96,alpha,,,095a2583-5694-461b-96bb-68881bc843af
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.43,0.29,0.7,0.79,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba,1080,1920,0.96,beta,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,095a2583-5694-461b-96bb-68881bc843af
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.52,0.15,0.76,0.47,0.07,35754be3-ed16-400e-b393-d1784401395b,1080,1920,0.42,beta,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,b7fb586f-f920-4359-be04-d95085431953
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_38.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_38"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_38')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(11)">Show/Hide</button>
                <div class="source-container" id="source-11">
                    <pre class="language-python" tabindex="0"><code class="language-python">def find_discordant_pairs(
    alpha_df: pd.DataFrame,
    beta_df: pd.DataFrame,
    label_model_name: str = &#34;alpha&#34;,
    inference_model_name: str = &#34;beta&#34;,
    iou_threshold: float = 0.5,
    allow_multi_matching: bool = False,
    parallel: bool = True,
) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Find discordant pairs between two dataframes.

    This is a wrapper for InferenceRunner.find_discordant_pairs.

    The original code assumed you would want to run inference before
    finding discordant pairs.

    In practice the way we used the code would be to compare two existing
    dataframes (either of labels and inferences or just inferences).

    This method makes that process as easy as possible without
    changing the existing implementation.

    Arguments:
        alpha_df: A pandas dataframe.
        beta_df: A pandas dataframe.
        label_model_name: A string for the ground truth labels.
        inference_model_name: A string for the inference labels.
        iou_threshold: A float between 0 and 1.
        allow_multi_matching: A boolean. If True, allow multiple inferences
            per label.
        parallel: A boolean. If True, run matching in parallel.

    Returns:
        A pandas dataframe with discordant pairs.

    Raises:
        ValueError: If either dataframe is empty.
    &#34;&#34;&#34;
    if len(alpha_df) == 0 or len(beta_df) == 0:
        raise ValueError(&#34;Discordant pairs cannot be found with any empty dataframes.&#34;)

    ensure_id(alpha_df)
    ensure_id(beta_df)

    alpha_df = alpha_df.copy()
    beta_df = beta_df.copy()

    # Set area columns if not set.
    machine_learning.bounding_box_ops.set_area_column(alpha_df)
    machine_learning.bounding_box_ops.set_area_column(beta_df)

    # Convert to evaluation format
    alpha_df = prepare_dataframe_for_evaluation(alpha_df)
    beta_df = prepare_dataframe_for_evaluation(beta_df)

    # Set model_name columns if not set.
    if &#34;model_name&#34; not in alpha_df.columns:
        alpha_df[&#34;model_name&#34;] = label_model_name

    if &#34;model_name&#34; not in beta_df.columns:
        beta_df[&#34;model_name&#34;] = inference_model_name

    model_name_alpha = alpha_df[&#34;model_name&#34;].iloc[0]
    model_name_beta = beta_df[&#34;model_name&#34;].iloc[0]

    # Create model_executors
    alpha_model_executor = MockModelExecutor(name=model_name_alpha)
    beta_model_executor = MockModelExecutor(name=model_name_beta)

    combined_df = pd.concat([alpha_df, beta_df])
    combined_df = combined_df.reset_index(drop=True)

    executors = [alpha_model_executor, beta_model_executor]

    return camera.inference_runner.InferenceRunner.find_discordant_pairs(
        executors,
        combined_df,
        iou_threshold=iou_threshold,
        allow_multi_matching=allow_multi_matching,
        parallel=parallel,
    )
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-4" id="node-12">
        <div class="call-header" onclick="toggleCall(12)">
            <span class="toggle-icon" id="icon-12">‚ñ∂</span>
            
        <span class="function-name">ensure_id(alpha_df)</span>
    
            
        <span class="file-info">[dataframe_ops.py:330]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-12" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-12" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(12)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(12)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-12"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-12" oninput="previewComment(12)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_10.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_10"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_10')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_11.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_11"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_11')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(12)">Show/Hide</button>
                <div class="source-container" id="source-12">
                    <pre class="language-python" tabindex="0"><code class="language-python">def ensure_id(df: pd.DataFrame) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Ensure that each row has a unique ID.

    Arguments:
        df: A pandas dataframe.

    Returns:
        The same dataframe with an id column.
    &#34;&#34;&#34;

    def _get_or_set_id(row: pd.Series) -&gt; str:
        &#34;&#34;&#34;Return the ID of the row or return a new ID.

        Arguments:
            row: A pandas series.

        Returns:
            The id of the row.
        &#34;&#34;&#34;
        existing_id = row.get(&#34;id&#34;)
        str_id = str(existing_id)
        # hack
        if str_id == &#34;nan&#34; or existing_id is None:
            new_id = str(uuid.uuid4())
            return new_id
        return str_id

    if &#34;id&#34; not in df.keys():
        df[&#34;id&#34;] = None

    df[&#34;id&#34;] = df.apply(_get_or_set_id, axis=1)
    return df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-4" id="node-14">
        <div class="call-header" onclick="toggleCall(14)">
            <span class="toggle-icon" id="icon-14">‚ñ∂</span>
            
        <span class="function-name">ensure_id(beta_df)</span>
    
            
        <span class="file-info">[dataframe_ops.py:331]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-14" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-14" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(14)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(14)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-14"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-14" oninput="previewComment(14)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_12.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_12"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_12')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_13.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_13"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_13')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(14)">Show/Hide</button>
                <div class="source-container" id="source-14">
                    <pre class="language-python" tabindex="0"><code class="language-python">def ensure_id(df: pd.DataFrame) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Ensure that each row has a unique ID.

    Arguments:
        df: A pandas dataframe.

    Returns:
        The same dataframe with an id column.
    &#34;&#34;&#34;

    def _get_or_set_id(row: pd.Series) -&gt; str:
        &#34;&#34;&#34;Return the ID of the row or return a new ID.

        Arguments:
            row: A pandas series.

        Returns:
            The id of the row.
        &#34;&#34;&#34;
        existing_id = row.get(&#34;id&#34;)
        str_id = str(existing_id)
        # hack
        if str_id == &#34;nan&#34; or existing_id is None:
            new_id = str(uuid.uuid4())
            return new_id
        return str_id

    if &#34;id&#34; not in df.keys():
        df[&#34;id&#34;] = None

    df[&#34;id&#34;] = df.apply(_get_or_set_id, axis=1)
    return df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-4" id="node-16">
        <div class="call-header" onclick="toggleCall(16)">
            <span class="toggle-icon" id="icon-16">‚ñ∂</span>
            
        <span class="function-name">machine_learning.bounding_box_ops.set_area_column(alpha_df)</span>
    
            
        <span class="file-info">[bounding_box_ops.py:337]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-16" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-16" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(16)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(16)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-16"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-16" oninput="previewComment(16)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_14.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_14"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_14')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_15.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_15"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_15')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(16)">Show/Hide</button>
                <div class="source-container" id="source-16">
                    <pre class="language-python" tabindex="0"><code class="language-python">def set_area_column(df: pd.DataFrame) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Add a column &#39;area&#39; to the dataframe.

    Arguments:
        df: A pandas dataframe with xmin, ymin, xmax, ymax in any coordinates.

    Returns:
        The same dataframe with an additional column &#39;area&#39;.
    &#34;&#34;&#34;
    if len(df) == 0:
        return df

    df[&#34;area&#34;] = (df.ymax - df.ymin) * (df.xmax - df.xmin)
    df.loc[df.area.isna(), &#34;area&#34;] = 0
    df[&#34;area&#34;] = df[&#34;area&#34;].astype(df.dtypes[&#34;xmin&#34;])
    return df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-4" id="node-18">
        <div class="call-header" onclick="toggleCall(18)">
            <span class="toggle-icon" id="icon-18">‚ñ∂</span>
            
        <span class="function-name">machine_learning.bounding_box_ops.set_area_column(beta_df)</span>
    
            
        <span class="file-info">[bounding_box_ops.py:338]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-18" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-18" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(18)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(18)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-18"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-18" oninput="previewComment(18)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_16.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_16"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_16')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_17.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_17"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_17')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(18)">Show/Hide</button>
                <div class="source-container" id="source-18">
                    <pre class="language-python" tabindex="0"><code class="language-python">def set_area_column(df: pd.DataFrame) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Add a column &#39;area&#39; to the dataframe.

    Arguments:
        df: A pandas dataframe with xmin, ymin, xmax, ymax in any coordinates.

    Returns:
        The same dataframe with an additional column &#39;area&#39;.
    &#34;&#34;&#34;
    if len(df) == 0:
        return df

    df[&#34;area&#34;] = (df.ymax - df.ymin) * (df.xmax - df.xmin)
    df.loc[df.area.isna(), &#34;area&#34;] = 0
    df[&#34;area&#34;] = df[&#34;area&#34;].astype(df.dtypes[&#34;xmin&#34;])
    return df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-4" id="node-20">
        <div class="call-header" onclick="toggleCall(20)">
            <span class="toggle-icon" id="icon-20">‚ñ∂</span>
            
        <span class="function-name">alpha_df = prepare_dataframe_for_evaluation(alpha_df)</span>
    
            
        <span class="file-info">[dataframe_ops.py:341]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-20" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-20" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(20)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(20)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-20"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-20" oninput="previewComment(20)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_18.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_18"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_18')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,class_name,xmin,ymin,xmax,ymax,area,id,image_height,image_width,score
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,CARDBOARD,0.43,0.16,0.75,0.79,0.2,be2b443a-373a-4f53-85ea-4109f113c245,1080,1920,0.96
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_25.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_25"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_25')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(20)">Show/Hide</button>
                <div class="source-container" id="source-20">
                    <pre class="language-python" tabindex="0"><code class="language-python">def prepare_dataframe_for_evaluation(df: pd.DataFrame) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Ensure the dataframe matches the format expected by the evaluation code.

    Arguments:
        df: A pandas dataframe.

    Returns:
        The same dataframe with modified columns.
    &#34;&#34;&#34;
    original_df = df.copy()

    df = ensure_normalized_coordinates(df)
    if &#34;filename&#34; in df.columns:
        df[&#34;image_name&#34;] = df[&#34;filename&#34;]
        del original_df[&#34;filename&#34;]
    elif &#34;s3_uri&#34; in df.columns:
        df[&#34;image_name&#34;] = df[&#34;s3_uri&#34;]
        del original_df[&#34;s3_uri&#34;]

    if &#34;class&#34; in df.columns:
        df[&#34;class_name&#34;] = df[&#34;class&#34;]
        del original_df[&#34;class&#34;]

    ensure_id(df)

    columns = [
        &#34;image_name&#34;,
        &#34;class_name&#34;,
        &#34;xmin&#34;,
        &#34;ymin&#34;,
        &#34;xmax&#34;,
        &#34;ymax&#34;,
        &#34;area&#34;,
        &#34;id&#34;,
    ]

    if &#34;polygon_coordinates&#34; in df.columns:
        columns.append(&#34;polygon_coordinates&#34;)

    df = df[columns]

    copy_columns_not_present(from_df=original_df, to_df=df)

    return df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-5" id="node-21">
        <div class="call-header" onclick="toggleCall(21)">
            <span class="toggle-icon" id="icon-21">‚ñ∂</span>
            
        <span class="function-name">df = ensure_normalized_coordinates(df)</span>
    
            
        <span class="file-info">[dataframe_ops.py:482]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-21" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-21" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(21)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(21)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-21"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-21" oninput="previewComment(21)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_19.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_19"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_19')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_20.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_20"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_20')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(21)">Show/Hide</button>
                <div class="source-container" id="source-21">
                    <pre class="language-python" tabindex="0"><code class="language-python">def ensure_normalized_coordinates(df: pd.DataFrame) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Run convert_to_normalized_coordinates if needed.

    Arguments:
        df: A pandas dataframe with xmin, ymin, xmax, ymax in any coordinates.

    Returns:
        The same dataframe with normalized coordinates.
    &#34;&#34;&#34;
    if all(
        [
            df[col].dtype == int
            for col in [
                &#34;xmin&#34;,
                &#34;xmax&#34;,
                &#34;ymin&#34;,
                &#34;ymax&#34;,
            ]
        ]
    ):
        return convert_to_normalized_coordinates(df, validate_column_types=False)
    return df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-5" id="node-23">
        <div class="call-header" onclick="toggleCall(23)">
            <span class="toggle-icon" id="icon-23">‚ñ∂</span>
            
        <span class="function-name">ensure_id(df)</span>
    
            
        <span class="file-info">[dataframe_ops.py:494]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-23" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-23" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(23)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(23)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-23"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-23" oninput="previewComment(23)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_21.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_21"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_21')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_22.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_22"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_22')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(23)">Show/Hide</button>
                <div class="source-container" id="source-23">
                    <pre class="language-python" tabindex="0"><code class="language-python">def ensure_id(df: pd.DataFrame) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Ensure that each row has a unique ID.

    Arguments:
        df: A pandas dataframe.

    Returns:
        The same dataframe with an id column.
    &#34;&#34;&#34;

    def _get_or_set_id(row: pd.Series) -&gt; str:
        &#34;&#34;&#34;Return the ID of the row or return a new ID.

        Arguments:
            row: A pandas series.

        Returns:
            The id of the row.
        &#34;&#34;&#34;
        existing_id = row.get(&#34;id&#34;)
        str_id = str(existing_id)
        # hack
        if str_id == &#34;nan&#34; or existing_id is None:
            new_id = str(uuid.uuid4())
            return new_id
        return str_id

    if &#34;id&#34; not in df.keys():
        df[&#34;id&#34;] = None

    df[&#34;id&#34;] = df.apply(_get_or_set_id, axis=1)
    return df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-5" id="node-25">
        <div class="call-header" onclick="toggleCall(25)">
            <span class="toggle-icon" id="icon-25">‚ñ∂</span>
            
        <span class="function-name">copy_columns_not_present(from_df=original_df, to_df=df)</span>
    
            
        <span class="file-info">[dataframe_ops.py:512]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-25" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-25" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(25)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(25)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-25"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-25" oninput="previewComment(25)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">from_df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_23.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_23"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_23')">
                             </div></span></div>
            
                <div><span style="color: #505050;">to_df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (1√ó8) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,class_name,xmin,ymin,xmax,ymax,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,CARDBOARD,0.43,0.16,0.75,0.79,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_24.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_24"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_24')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">None</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(25)">Show/Hide</button>
                <div class="source-container" id="source-25">
                    <pre class="language-python" tabindex="0"><code class="language-python">def copy_columns_not_present(from_df: pd.DataFrame, to_df: pd.DataFrame) -&gt; None:
    &#34;&#34;&#34;Transfer all columns not present in to_df from from_df.

    Arguments:
        from_df: A pandas dataframe.
        to_df: A pandas dataframe.
    &#34;&#34;&#34;
    columns_to_copy = from_df.columns.difference(to_df.columns)
    to_df[columns_to_copy] = from_df[columns_to_copy]
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-4" id="node-28">
        <div class="call-header" onclick="toggleCall(28)">
            <span class="toggle-icon" id="icon-28">‚ñ∂</span>
            
        <span class="function-name">beta_df = prepare_dataframe_for_evaluation(beta_df)</span>
    
            
        <span class="file-info">[dataframe_ops.py:342]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-28" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-28" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(28)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(28)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-28"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-28" oninput="previewComment(28)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_26.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_26"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_26')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,class_name,xmin,ymin,xmax,ymax,area,id,polygon_coordinates,image_height,image_width,is_segmentation,score
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.43,0.29,0.7,0.79,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,1080,1920,True,0.96
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.52,0.15,0.76,0.47,0.07,35754be3-ed16-400e-b393-d1784401395b,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,1080,1920,True,0.42
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_33.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_33"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_33')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(28)">Show/Hide</button>
                <div class="source-container" id="source-28">
                    <pre class="language-python" tabindex="0"><code class="language-python">def prepare_dataframe_for_evaluation(df: pd.DataFrame) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Ensure the dataframe matches the format expected by the evaluation code.

    Arguments:
        df: A pandas dataframe.

    Returns:
        The same dataframe with modified columns.
    &#34;&#34;&#34;
    original_df = df.copy()

    df = ensure_normalized_coordinates(df)
    if &#34;filename&#34; in df.columns:
        df[&#34;image_name&#34;] = df[&#34;filename&#34;]
        del original_df[&#34;filename&#34;]
    elif &#34;s3_uri&#34; in df.columns:
        df[&#34;image_name&#34;] = df[&#34;s3_uri&#34;]
        del original_df[&#34;s3_uri&#34;]

    if &#34;class&#34; in df.columns:
        df[&#34;class_name&#34;] = df[&#34;class&#34;]
        del original_df[&#34;class&#34;]

    ensure_id(df)

    columns = [
        &#34;image_name&#34;,
        &#34;class_name&#34;,
        &#34;xmin&#34;,
        &#34;ymin&#34;,
        &#34;xmax&#34;,
        &#34;ymax&#34;,
        &#34;area&#34;,
        &#34;id&#34;,
    ]

    if &#34;polygon_coordinates&#34; in df.columns:
        columns.append(&#34;polygon_coordinates&#34;)

    df = df[columns]

    copy_columns_not_present(from_df=original_df, to_df=df)

    return df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-5" id="node-29">
        <div class="call-header" onclick="toggleCall(29)">
            <span class="toggle-icon" id="icon-29">‚ñ∂</span>
            
        <span class="function-name">df = ensure_normalized_coordinates(df)</span>
    
            
        <span class="file-info">[dataframe_ops.py:482]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-29" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-29" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(29)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(29)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-29"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-29" oninput="previewComment(29)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_27.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_27"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_27')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_28.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_28"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_28')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(29)">Show/Hide</button>
                <div class="source-container" id="source-29">
                    <pre class="language-python" tabindex="0"><code class="language-python">def ensure_normalized_coordinates(df: pd.DataFrame) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Run convert_to_normalized_coordinates if needed.

    Arguments:
        df: A pandas dataframe with xmin, ymin, xmax, ymax in any coordinates.

    Returns:
        The same dataframe with normalized coordinates.
    &#34;&#34;&#34;
    if all(
        [
            df[col].dtype == int
            for col in [
                &#34;xmin&#34;,
                &#34;xmax&#34;,
                &#34;ymin&#34;,
                &#34;ymax&#34;,
            ]
        ]
    ):
        return convert_to_normalized_coordinates(df, validate_column_types=False)
    return df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-5" id="node-31">
        <div class="call-header" onclick="toggleCall(31)">
            <span class="toggle-icon" id="icon-31">‚ñ∂</span>
            
        <span class="function-name">ensure_id(df)</span>
    
            
        <span class="file-info">[dataframe_ops.py:494]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-31" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-31" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(31)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(31)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-31"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-31" oninput="previewComment(31)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_29.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_29"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_29')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_30.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_30"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_30')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(31)">Show/Hide</button>
                <div class="source-container" id="source-31">
                    <pre class="language-python" tabindex="0"><code class="language-python">def ensure_id(df: pd.DataFrame) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Ensure that each row has a unique ID.

    Arguments:
        df: A pandas dataframe.

    Returns:
        The same dataframe with an id column.
    &#34;&#34;&#34;

    def _get_or_set_id(row: pd.Series) -&gt; str:
        &#34;&#34;&#34;Return the ID of the row or return a new ID.

        Arguments:
            row: A pandas series.

        Returns:
            The id of the row.
        &#34;&#34;&#34;
        existing_id = row.get(&#34;id&#34;)
        str_id = str(existing_id)
        # hack
        if str_id == &#34;nan&#34; or existing_id is None:
            new_id = str(uuid.uuid4())
            return new_id
        return str_id

    if &#34;id&#34; not in df.keys():
        df[&#34;id&#34;] = None

    df[&#34;id&#34;] = df.apply(_get_or_set_id, axis=1)
    return df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-5" id="node-33">
        <div class="call-header" onclick="toggleCall(33)">
            <span class="toggle-icon" id="icon-33">‚ñ∂</span>
            
        <span class="function-name">copy_columns_not_present(from_df=original_df, to_df=df)</span>
    
            
        <span class="file-info">[dataframe_ops.py:512]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-33" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-33" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(33)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(33)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-33"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-33" oninput="previewComment(33)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">from_df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó13) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,polygon_coordinates,is_segmentation,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.29,0.7,0.79,0.96,BOX_BASE,1920,1080,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.52,0.15,0.76,0.47,0.42,BOX_BASE,1920,1080,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,0.07,35754be3-ed16-400e-b393-d1784401395b
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_31.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_31"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_31')">
                             </div></span></div>
            
                <div><span style="color: #505050;">to_df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (2√ó9) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,class_name,xmin,ymin,xmax,ymax,area,id,polygon_coordinates
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.43,0.29,0.7,0.79,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.52,0.15,0.76,0.47,0.07,35754be3-ed16-400e-b393-d1784401395b,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_32.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_32"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_32')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">None</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(33)">Show/Hide</button>
                <div class="source-container" id="source-33">
                    <pre class="language-python" tabindex="0"><code class="language-python">def copy_columns_not_present(from_df: pd.DataFrame, to_df: pd.DataFrame) -&gt; None:
    &#34;&#34;&#34;Transfer all columns not present in to_df from from_df.

    Arguments:
        from_df: A pandas dataframe.
        to_df: A pandas dataframe.
    &#34;&#34;&#34;
    columns_to_copy = from_df.columns.difference(to_df.columns)
    to_df[columns_to_copy] = from_df[columns_to_copy]
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-4" id="node-36">
        <div class="call-header" onclick="toggleCall(36)">
            <span class="toggle-icon" id="icon-36">‚ñ∂</span>
            
        <span class="function-name">return camera.inference_runner.InferenceRunner.find_discordant_pairs(executors,
        combined_df,
        iou_threshold=iou_threshold,
        allow_multi_matching=allow_multi_matching,
        parallel=parallel)</span>
    
            
        <span class="file-info">[inference_runner.py:363-369]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-36" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-36" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(36)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(36)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-36"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-36" oninput="previewComment(36)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">executors:</span> <span style="color: rgb(0, 86, 179);">[&lt;machine_learning.dataframe_ops.MockModelExecutor object at 0x799de9989760&gt;, &lt;machine_learning.dataframe_ops.MockModelExecutor object at 0x799de9fd2820&gt;]</span></div>
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (3√ó14) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,class_name,xmin,ymin,xmax,ymax,area,id,image_height,image_width,score,model_name,polygon_coordinates,is_segmentation
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,CARDBOARD,0.43,0.16,0.75,0.79,0.2,be2b443a-373a-4f53-85ea-4109f113c245,1080,1920,0.96,alpha,,
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.43,0.29,0.7,0.79,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba,1080,1920,0.96,beta,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.52,0.15,0.76,0.47,0.07,35754be3-ed16-400e-b393-d1784401395b,1080,1920,0.42,beta,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_34.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_34"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_34')">
                             </div></span></div>
            
                <div><span style="color: #505050;">iou_threshold:</span> <span style="color: rgb(0, 86, 179);">0.05</span></div>
            
                <div><span style="color: #505050;">allow_multi_matching:</span> <span style="color: rgb(0, 86, 179);">False</span></div>
            
                <div><span style="color: #505050;">parallel:</span> <span style="color: rgb(0, 86, 179);">True</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (3√ó15) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,class_name,xmin,ymin,xmax,ymax,area,id,image_height,image_width,score,model_name,polygon_coordinates,is_segmentation,group_id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,CARDBOARD,0.43,0.16,0.75,0.79,0.2,be2b443a-373a-4f53-85ea-4109f113c245,1080,1920,0.96,alpha,,,095a2583-5694-461b-96bb-68881bc843af
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.43,0.29,0.7,0.79,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba,1080,1920,0.96,beta,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,095a2583-5694-461b-96bb-68881bc843af
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.52,0.15,0.76,0.47,0.07,35754be3-ed16-400e-b393-d1784401395b,1080,1920,0.42,beta,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,b7fb586f-f920-4359-be04-d95085431953
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_37.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_37"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_37')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(36)">Show/Hide</button>
                <div class="source-container" id="source-36">
                    <pre class="language-python" tabindex="0"><code class="language-python">    @staticmethod
    def find_discordant_pairs(
        executors: List[model_executor.ModelExecutor],
        df: pd.DataFrame,
        iou_threshold: float,
        allow_multi_matching: bool = False,
        parallel: bool = True,
    ) -&gt; pd.DataFrame:
        &#34;&#34;&#34;Find discordant pairs between inferences of the same photo.

        Args:
            executors (List[model_executor.ModelExecutor]): list of cv models
            df (pd.DataFrame): dataframe containing the columns image_name,
                model_name, ymin, ymax, xmin, xmax, class_name, score, area
            iou_threshold (float): value between 0 and 1 that represents how
                much area overlap two bounding boxes need to have to be
                considered the same bounding box
            allow_multi_matching (bool): If True, allow multiple inferences to
                be assigned to a single label.
            parallel (bool): whether to run matching in parallel

        Returns:
            pd.DataFrame: dataframe containing the discordant pairs
        &#34;&#34;&#34;
        assert len(executors) == 2, &#34;Expected 2 executors&#34;
        alpha, beta = executors[0].name, executors[1].name

        df = df.query(&#34;class_name != &#39;BACKGROUND&#39;&#34;)

        groups = df.groupby(&#34;image_name&#34;)

        def handler(image_df: pd.DataFrame) -&gt; pd.DataFrame:
            &#34;&#34;&#34;Assign group IDs to one image group.

            Args:
                image_df (pd.DataFrame): DataFrame containing the columns
                    ymin, xmin, ymax, xmax, class_name, model_name, id

            Returns:
                pd.DataFrame: DataFrame with group ids assigned
            &#34;&#34;&#34;
            return InferenceRunner.assign_groups(
                image_df,
                iou_threshold,
                alpha,
                beta,
                allow_multi_matching=allow_multi_matching,
            )

        if parallel:
            result = parallelize_dataframe_groupby_apply(groups, handler)
        else:
            result = groups.apply(handler)

        return result.reset_index(drop=True)
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-5" id="node-37">
        <div class="call-header" onclick="toggleCall(37)">
            <span class="toggle-icon" id="icon-37">‚ñ∂</span>
            
        <span class="function-name">result = parallelize_dataframe_groupby_apply(groups, handler)</span>
    
            
        <span class="file-info">[inference_runner.py:202]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-37" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-37" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(37)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(37)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-37"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-37" oninput="previewComment(37)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">grouped:</span> <span style="color: rgb(0, 86, 179);">DataFrameGroupBy(&lt;instance inspection failed: The truth value of a DataFrame is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().&gt;)</span></div>
            
                <div><span style="color: #505050;">func:</span> <span style="color: rgb(0, 86, 179);">function()</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (3√ó15) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,class_name,xmin,ymin,xmax,ymax,area,id,image_height,image_width,score,model_name,polygon_coordinates,is_segmentation,group_id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,CARDBOARD,0.43,0.16,0.75,0.79,0.2,be2b443a-373a-4f53-85ea-4109f113c245,1080,1920,0.96,alpha,,,095a2583-5694-461b-96bb-68881bc843af
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.43,0.29,0.7,0.79,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba,1080,1920,0.96,beta,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,095a2583-5694-461b-96bb-68881bc843af
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.52,0.15,0.76,0.47,0.07,35754be3-ed16-400e-b393-d1784401395b,1080,1920,0.42,beta,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,b7fb586f-f920-4359-be04-d95085431953
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_36.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_36"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_36')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(37)">Show/Hide</button>
                <div class="source-container" id="source-37">
                    <pre class="language-python" tabindex="0"><code class="language-python">def parallelize_dataframe_groupby_apply(
    grouped: pd.core.groupby.generic.DataFrameGroupBy,
    func: Callable[[pd.DataFrame], pd.DataFrame],
) -&gt; pd.DataFrame:
    &#34;&#34;&#34;
    Parallelize application of a function across DataFrameGroupBy objects.

    Args:
        grouped (pd.core.groupby.generic.DataFrameGroupBy): The GroupBy object
            to process.
        func (Callable[[pd.DataFrame], pd.DataFrame]): The function to apply to
            each group.

    Returns:
        pd.DataFrame: A DataFrame resulting from concatenating the results.
    &#34;&#34;&#34;
    group_keys = grouped.groups.keys()

    with ThreadPoolExecutor() as executor:
        results = executor.map(
            lambda key: worker(key, grouped, func),
            group_keys,
        )

    return pd.concat(results)
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-0" id="node-38">
        <div class="call-header" onclick="toggleCall(38)">
            <span class="toggle-icon" id="icon-38">‚ñ∂</span>
            
            <span class="method-indicator">[Future]</span> 
        <span class="function-name">return pd.concat(results)</span>
    
        
            
        <span class="file-info">[_base.py:441]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-38" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-38" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(38)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(38)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-38"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-38" oninput="previewComment(38)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">self:</span> <span style="color: rgb(0, 86, 179);">concurrent.futures._base.Future()</span></div>
            
                <div><span style="color: #505050;">timeout:</span> <span style="color: rgb(0, 86, 179);">None</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (3√ó15) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,class_name,xmin,ymin,xmax,ymax,area,id,image_height,image_width,score,model_name,polygon_coordinates,is_segmentation,group_id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,CARDBOARD,0.43,0.16,0.75,0.79,0.2,be2b443a-373a-4f53-85ea-4109f113c245,1080,1920,0.96,alpha,,,095a2583-5694-461b-96bb-68881bc843af
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.43,0.29,0.7,0.79,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba,1080,1920,0.96,beta,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,095a2583-5694-461b-96bb-68881bc843af
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.52,0.15,0.76,0.47,0.07,35754be3-ed16-400e-b393-d1784401395b,1080,1920,0.42,beta,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,b7fb586f-f920-4359-be04-d95085431953
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_35.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_35"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_35')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(38)">Show/Hide</button>
                <div class="source-container" id="source-38">
                    <pre class="language-python" tabindex="0"><code class="language-python">    def result(self, timeout=None):
        &#34;&#34;&#34;Return the result of the call that the future represents.

        Args:
            timeout: The number of seconds to wait for the result if the future
                isn&#39;t done. If None, then there is no limit on the wait time.

        Returns:
            The result of the call that the future represents.

        Raises:
            CancelledError: If the future was cancelled.
            TimeoutError: If the future didn&#39;t finish executing before the given
                timeout.
            Exception: If the call raised then that exception will be raised.
        &#34;&#34;&#34;
        try:
            with self._condition:
                if self._state in [CANCELLED, CANCELLED_AND_NOTIFIED]:
                    raise CancelledError()
                elif self._state == FINISHED:
                    return self.__get_result()

                self._condition.wait(timeout)

                if self._state in [CANCELLED, CANCELLED_AND_NOTIFIED]:
                    raise CancelledError()
                elif self._state == FINISHED:
                    return self.__get_result()
                else:
                    raise TimeoutError()
        finally:
            # Break a reference cycle with the exception in self._exception
            self = None
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-3" id="node-43">
        <div class="call-header" onclick="toggleCall(43)">
            <span class="toggle-icon" id="icon-43">‚ñ∂</span>
            
        <span class="function-name">surface_area_features = utils.get_surface_area_features_for_discordant_pairs_df(discordant_pairs)</span>
    
            
        <span class="file-info">[utils.py:127-129]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-43" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-43" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(43)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(43)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-43"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-43" oninput="previewComment(43)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">discordant_pairs:</span> <span style="color: rgb(0, 86, 179);">DataFrame (3√ó15) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,class_name,xmin,ymin,xmax,ymax,area,id,image_height,image_width,score,model_name,polygon_coordinates,is_segmentation,group_id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,CARDBOARD,0.43,0.16,0.75,0.79,0.2,be2b443a-373a-4f53-85ea-4109f113c245,1080,1920,0.96,alpha,,,095a2583-5694-461b-96bb-68881bc843af
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.43,0.29,0.7,0.79,0.14,acb7d5ab-eb6f-4fe8-9aad-7684b1bacdba,1080,1920,0.96,beta,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,095a2583-5694-461b-96bb-68881bc843af
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,BOX_BASE,0.52,0.15,0.76,0.47,0.07,35754be3-ed16-400e-b393-d1784401395b,1080,1920,0.42,beta,&quot;[(0.5776041666666667, 0.1712962962962963), (0.759375, 0.33796296296296297), (0.759375, 0.3398148148148148), (0.7229166666666667, 0.4388888888888889), (0.7166666666666667, 0.4546296296296296), (0.7041666666666667, 0.48333333333333334), (0.521875, 0.48333333333333334), (0.521875, 0.28055555555555556), (0.565625, 0.1712962962962963)]&quot;,True,b7fb586f-f920-4359-be04-d95085431953
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_39.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_39"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_39')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">{&#x27;box_length_cm&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: 25.671628909271057}, &#x27;box_width_cm&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: 28.960996182914716}, &#x27;box_height_cm&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: 26.5922}, &#x27;device_id&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: &#x27;SCN-011&#x27;}, &#x27;polygon_coordinates&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: [(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]}, &#x27;has_depth_map&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: True}}</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(43)">Show/Hide</button>
                <div class="source-container" id="source-43">
                    <pre class="language-python" tabindex="0"><code class="language-python">def get_surface_area_features_for_discordant_pairs_df(
    discordant_pairs: pd.DataFrame,
) -&gt; Dict:
    &#34;&#34;&#34;Get surface area features from discordant pairs DataFrame.

    Args:
        discordant_pairs: DataFrame containing discordant detection pairs.

    Returns:
        Dictionary mapping feature names to row ID mappings.
    &#34;&#34;&#34;
    weight_features = {}
    depth_maps = {}
    for _, group_df in discordant_pairs.groupby(&#34;group_id&#34;):
        box_base = group_df.query(&#34;class_name == &#39;BOX_BASE&#39;&#34;)
        cardboard_box = group_df.query(&#39;class_name == &#34;CARDBOARD&#34;&#39;)
        if len(cardboard_box) == 0:
            continue

        row = cardboard_box.iloc[0]

        if row.image_name not in depth_maps:
            depth_maps[row.image_name] = try_load_depth_map_from_s3(row.image_name)

        if len(box_base) &gt; 0:
            polygon_coordinates = box_base.iloc[0].polygon_coordinates
        else:
            # Fall back to the cardboard box bounding box coordinates
            # if no &#34;BOX_BASE&#34; polygon is available.
            polygon_coordinates = [
                # clockwise
                (row.xmin, row.ymin),
                (row.xmax, row.ymin),
                (row.xmax, row.ymax),
                (row.xmin, row.ymax),
            ]

        features = get_surface_area_features(
            row.image_name,
            row.image_width,
            row.image_height,
            polygon_coordinates,
            depth_maps[row.image_name],
        )
        for feature, value in features.items():
            weight_features.setdefault(feature, {})[row.id] = value

    return weight_features
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-4" id="node-44">
        <div class="call-header" onclick="toggleCall(44)">
            <span class="toggle-icon" id="icon-44">‚ñ∂</span>
            
        <span class="function-name">depth_maps[row.image_name] = try_load_depth_map_from_s3(row.image_name)</span>
    
            
        <span class="file-info">[utils.py:219]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-44" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-44" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(44)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(44)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-44"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-44" oninput="previewComment(44)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">image_s3_uri:</span> <span style="color: rgb(0, 86, 179);">&#x27;s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg&#x27;</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value"><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920), uint16)</div>
                                 <img src="images/img_41.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920), uint16)"
                                      class="trace-image"
                                      id="trace-img-img_41"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_41')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(44)">Show/Hide</button>
                <div class="source-container" id="source-44">
                    <pre class="language-python" tabindex="0"><code class="language-python">def try_load_depth_map_from_s3(image_s3_uri: Optional[str]) -&gt; np.ndarray:
    &#34;&#34;&#34;Try to load depth map from S3, returning None if unsuccessful.

    Args:
        image_s3_uri: S3 URI for the image file.

    Returns:
        Loaded depth map array, or None if loading fails.
    &#34;&#34;&#34;
    if not image_s3_uri:
        return None

    depth_file = str(image_s3_uri).replace(&#34;.jpg&#34;, &#34;.npz&#34;)
    depth_map = None
    try:
        depth_map = load_depth_from_s3(depth_file)
    except Exception as e:
        logging.warning(f&#34;Could not load depth map from {depth_file}: {e}&#34;)

    return depth_map
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-5" id="node-45">
        <div class="call-header" onclick="toggleCall(45)">
            <span class="toggle-icon" id="icon-45">‚ñ∂</span>
            
        <span class="function-name">depth_map = load_depth_from_s3(depth_file)</span>
    
            
        <span class="file-info">[utils.py:408]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-45" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-45" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(45)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(45)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-45"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-45" oninput="previewComment(45)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">s3_uri:</span> <span style="color: rgb(0, 86, 179);">&#x27;s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.npz&#x27;</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value"><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920), uint16)</div>
                                 <img src="images/img_40.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920), uint16)"
                                      class="trace-image"
                                      id="trace-img-img_40"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_40')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(45)">Show/Hide</button>
                <div class="source-container" id="source-45">
                    <pre class="language-python" tabindex="0"><code class="language-python">def load_depth_from_s3(s3_uri: str) -&gt; np.ndarray:
    &#34;&#34;&#34;
    Download and load a depth map from S3.

    Args:
        s3_uri (str): S3 URI or key for the depth file

    Returns:
        np.ndarray: Loaded depth map

    Raises:
        ValueError: If there is an error loading the depth map
    &#34;&#34;&#34;
    bucket, key = parse_s3_uri(s3_uri)
    try:
        s3 = boto3.client(&#34;s3&#34;)
        response = s3.get_object(Bucket=bucket, Key=key)
        file_content = response[&#34;Body&#34;].read()
        return np.load(io.BytesIO(file_content), allow_pickle=True)[&#34;depth&#34;]
    except Exception as e:
        raise ValueError(f&#34;Error loading depth map from {s3_uri}: {str(e)}&#34;)
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-0" id="node-46">
        <div class="call-header" onclick="toggleCall(46)">
            <span class="toggle-icon" id="icon-46">‚ñ∂</span>
            
        <span class="function-name">bucket, key = parse_s3_uri(s3_uri)</span>
    
            
        <span class="file-info">[utils.py:383]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-46" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-46" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(46)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(46)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-46"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-46" oninput="previewComment(46)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">s3_uri:</span> <span style="color: rgb(0, 86, 179);">&#x27;s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.npz&#x27;</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">(&#x27;scanner-data.us-west-2&#x27;, &#x27;SCN-011/2025/07/01/15/36/32-102661_0.npz&#x27;)</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(46)">Show/Hide</button>
                <div class="source-container" id="source-46">
                    <pre class="language-python" tabindex="0"><code class="language-python">def parse_s3_uri(s3_uri: str) -&gt; tuple[str, str]:
    &#34;&#34;&#34;
    Parse an S3 URI or key into bucket and key components.

    Args:
        s3_uri (str): Either a full S3 URI (s3://bucket/key) or just a key

    Returns:
        Tuple[str, str]: bucket and key
    &#34;&#34;&#34;
    if s3_uri.startswith(&#34;s3://&#34;):
        # Parse S3 URI into bucket and key
        bucket, key = s3_uri.replace(&#34;s3://&#34;, &#34;&#34;).split(&#34;/&#34;, 1)
    else:
        # Treat s3_uri as a key in the default bucket
        bucket, key = consts.DEFAULT_BUCKET, s3_uri
    return bucket, key
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-4" id="node-50">
        <div class="call-header" onclick="toggleCall(50)">
            <span class="toggle-icon" id="icon-50">‚ñ∂</span>
            
        <span class="function-name">features = get_surface_area_features(row.image_name,
            row.image_width,
            row.image_height,
            polygon_coordinates,
            depth_maps[row.image_name])</span>
    
            
        <span class="file-info">[utils.py:234-240]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-50" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-50" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(50)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(50)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-50"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-50" oninput="previewComment(50)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">image_name:</span> <span style="color: rgb(0, 86, 179);">&#x27;s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg&#x27;</span></div>
            
                <div><span style="color: #505050;">image_width:</span> <span style="color: rgb(0, 86, 179);">1920</span></div>
            
                <div><span style="color: #505050;">image_height:</span> <span style="color: rgb(0, 86, 179);">1080</span></div>
            
                <div><span style="color: #505050;">polygon_coordinates:</span> <span style="color: rgb(0, 86, 179);">[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]</span></div>
            
                <div><span style="color: #505050;">depth_map:</span> <span style="color: rgb(0, 86, 179);"><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920), uint16)</div>
                                 <img src="images/img_42.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920), uint16)"
                                      class="trace-image"
                                      id="trace-img-img_42"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_42')">
                             </div></span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">{&#x27;box_length_cm&#x27;: 25.671628909271057, &#x27;box_width_cm&#x27;: 28.960996182914716, &#x27;box_height_cm&#x27;: 26.5922, &#x27;device_id&#x27;: &#x27;SCN-011&#x27;, &#x27;polygon_coordinates&#x27;: [(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)], &#x27;has_depth_map&#x27;: True}</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(50)">Show/Hide</button>
                <div class="source-container" id="source-50">
                    <pre class="language-python" tabindex="0"><code class="language-python">def get_surface_area_features(
    image_name: str,
    image_width: int,
    image_height: int,
    polygon_coordinates: List[Tuple[float, float]],
    depth_map: Optional[np.ndarray],
) -&gt; Dict:
    &#34;&#34;&#34;Add weight estimate using the cardboard weight feature creator.&#34;&#34;&#34;
    device_id = infer_device_id(image_name)

    box_height_cm = calculate_height_from_depth_map(
        depth_map, polygon_coordinates, device_id
    )

    if polygon_coordinates is not None:
        dimensions = calculate_dimensions_from_polygon(
            polygon_coordinates, image_height, image_width, box_height_cm, device_id
        )
        features = {
            **dimensions,
            &#34;device_id&#34;: device_id,
            &#34;polygon_coordinates&#34;: polygon_coordinates,
            &#34;has_depth_map&#34;: depth_map is not None,
        }
    else:
        features = {
            &#34;box_length_cm&#34;: np.nan,
            &#34;box_width_cm&#34;: np.nan,
            &#34;box_height_cm&#34;: box_height_cm,
            &#34;device_id&#34;: device_id,
            &#34;polygon_coordinates&#34;: None,
            &#34;has_depth_map&#34;: depth_map is not None,
        }
    return features
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-5" id="node-51">
        <div class="call-header" onclick="toggleCall(51)">
            <span class="toggle-icon" id="icon-51">‚ñ∂</span>
            
        <span class="function-name">device_id = infer_device_id(image_name)</span>
    
            
        <span class="file-info">[utils.py:169]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-51" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-51" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(51)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(51)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-51"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-51" oninput="previewComment(51)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">s3_uri:</span> <span style="color: rgb(0, 86, 179);">&#x27;s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg&#x27;</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">&#x27;SCN-011&#x27;</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(51)">Show/Hide</button>
                <div class="source-container" id="source-51">
                    <pre class="language-python" tabindex="0"><code class="language-python">def infer_device_id(s3_uri: str) -&gt; str:
    &#34;&#34;&#34;Infer device ID from S3 URI path.

    Args:
        s3_uri: S3 URI string.

    Returns:
        Device ID extracted from the URI path.
    &#34;&#34;&#34;
    key = s3_uri.split(&#34;/scanner-data.us-west-2/&#34;)[1]
    split = key.split(&#34;/&#34;)
    return split[0].upper()
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-5" id="node-53">
        <div class="call-header" onclick="toggleCall(53)">
            <span class="toggle-icon" id="icon-53">‚ñ∂</span>
            
        <span class="function-name">box_height_cm = calculate_height_from_depth_map(depth_map, polygon_coordinates, device_id)</span>
    
            
        <span class="file-info">[utils.py:171-173]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-53" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-53" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(53)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(53)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-53"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-53" oninput="previewComment(53)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">depth_map:</span> <span style="color: rgb(0, 86, 179);"><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920), uint16)</div>
                                 <img src="images/img_43.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920), uint16)"
                                      class="trace-image"
                                      id="trace-img-img_43"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_43')">
                             </div></span></div>
            
                <div><span style="color: #505050;">polygon_coordinates:</span> <span style="color: rgb(0, 86, 179);">[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]</span></div>
            
                <div><span style="color: #505050;">device_id:</span> <span style="color: rgb(0, 86, 179);">&#x27;SCN-011&#x27;</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">26.5922</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(53)">Show/Hide</button>
                <div class="source-container" id="source-53">
                    <pre class="language-python" tabindex="0"><code class="language-python">def calculate_height_from_depth_map(
    depth_map: Optional[np.ndarray],
    polygon_coordinates: List[Tuple[float, float]],
    device_id: str,
) -&gt; Optional[float]:
    &#34;&#34;&#34;Calculate height from depth map using polygon coordinates and device ID.

    Args:
        depth_map: Depth map array, or None if not available.
        polygon_coordinates: List of polygon coordinate tuples.
        device_id: Device identifier for calibration parameters.

    Returns:
        Calculated height in centimeters, or None if depth map unavailable.
    &#34;&#34;&#34;
    if depth_map is not None and polygon_coordinates is not None:
        box_height_in_depth_map_terms = get_object_height(
            polygon_coordinates,
            depth_map,
            device_id,
        )
        return estimate_height_in_cm_from_depth_map_height(
            box_height_in_depth_map_terms
        )
    return None
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-0" id="node-54">
        <div class="call-header" onclick="toggleCall(54)">
            <span class="toggle-icon" id="icon-54">‚ñ∂</span>
            
        <span class="function-name">box_height_in_depth_map_terms = get_object_height(polygon_coordinates,
            depth_map,
            device_id)</span>
    
            
        <span class="file-info">[utils.py:53-57]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-54" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-54" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(54)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(54)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-54"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-54" oninput="previewComment(54)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">segmentation_mask:</span> <span style="color: rgb(0, 86, 179);">[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]</span></div>
            
                <div><span style="color: #505050;">depth_map:</span> <span style="color: rgb(0, 86, 179);"><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920), uint16)</div>
                                 <img src="images/img_44.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920), uint16)"
                                      class="trace-image"
                                      id="trace-img-img_44"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_44')">
                             </div></span></div>
            
                <div><span style="color: #505050;">device_id:</span> <span style="color: rgb(0, 86, 179);">&#x27;SCN-011&#x27;</span></div>
            
                <div><span style="color: #505050;">normalize:</span> <span style="color: rgb(0, 86, 179);">False</span></div>
            
                <div><span style="color: #505050;">percentile:</span> <span style="color: rgb(0, 86, 179);">20.0</span></div>
            
                <div><span style="color: #505050;">min_valid_depth:</span> <span style="color: rgb(0, 86, 179);">0.1</span></div>
            
                <div><span style="color: #505050;">max_valid_depth:</span> <span style="color: rgb(0, 86, 179);">10000.0</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">295.25</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(54)">Show/Hide</button>
                <div class="source-container" id="source-54">
                    <pre class="language-python" tabindex="0"><code class="language-python">def get_object_height(
    segmentation_mask: np.ndarray,
    depth_map: np.ndarray,
    device_id: str,
    normalize: bool = False,
    percentile: float = 20.0,
    min_valid_depth: float = 0.1,
    max_valid_depth: float = 10000.0,
) -&gt; float:
    &#34;&#34;&#34;Calculate object height from segmentation mask and depth map.

    Args:
        segmentation_mask: Array of mask coordinates.
        depth_map: Depth map array.
        device_id: Device identifier for empty belt depth lookup.
        normalize: Whether to normalize the height by empty belt depth.
        percentile: Percentile value for depth calculation.
        min_valid_depth: Minimum valid depth value for filtering.
        max_valid_depth: Maximum valid depth value for filtering.

    Returns:
        Object height value.

    Raises:
        ValueError: If inputs are invalid or no valid depth values found.
    &#34;&#34;&#34;
    if not segmentation_mask:
        raise ValueError(&#34;Segmentation mask cannot be empty&#34;)

    if depth_map.size == 0:
        raise ValueError(&#34;Depth map cannot be empty&#34;)

    if device_id not in consts.EMPTY_BELT_DEPTH:
        raise ValueError(f&#34;Unknown device_id: {device_id}&#34;)

    h, w = depth_map.shape

    mask = np.array(segmentation_mask)
    mask[:, 0] = np.clip(mask[:, 0] * w, 0, w - 1)
    mask[:, 1] = np.clip(mask[:, 1] * h, 0, h - 1)
    mask = mask.astype(int)

    binary_mask = np.zeros_like(depth_map, dtype=np.uint8)
    try:
        cv2.fillPoly(binary_mask, [mask], 1)
    except cv2.error as e:
        raise ValueError(f&#34;Invalid segmentation mask coordinates: {e}&#34;)

    depth_values = depth_map[binary_mask == 1]

    if len(depth_values) == 0:
        raise ValueError(&#34;No pixels found within segmentation mask&#34;)

    valid_depth_values = filter_invalid_depths(
        depth_values, min_valid_depth, max_valid_depth
    )

    if len(valid_depth_values) == 0:
        raise ValueError(&#34;No valid depth values found within segmentation mask&#34;)

    object_depth = float(np.percentile(valid_depth_values, percentile))

    empty_belt_depth = consts.EMPTY_BELT_DEPTH[device_id]
    object_height = empty_belt_depth - object_depth

    if normalize:
        if empty_belt_depth == 0:
            raise ValueError(&#34;Cannot normalize: empty belt depth is zero&#34;)
        return object_height / empty_belt_depth
    else:
        return object_height
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-1" id="node-55">
        <div class="call-header" onclick="toggleCall(55)">
            <span class="toggle-icon" id="icon-55">‚ñ∂</span>
            
        <span class="function-name">valid_depth_values = filter_invalid_depths(depth_values, min_valid_depth, max_valid_depth)</span>
    
            
        <span class="file-info">[utils.py:350-352]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-55" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-55" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(55)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(55)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-55"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-55" oninput="previewComment(55)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">depth_values:</span> <span style="color: rgb(0, 86, 179);">numpy.ndarray()</span></div>
            
                <div><span style="color: #505050;">min_valid_depth:</span> <span style="color: rgb(0, 86, 179);">0.1</span></div>
            
                <div><span style="color: #505050;">max_valid_depth:</span> <span style="color: rgb(0, 86, 179);">10000.0</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">numpy.ndarray()</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(55)">Show/Hide</button>
                <div class="source-container" id="source-55">
                    <pre class="language-python" tabindex="0"><code class="language-python">def filter_invalid_depths(
    depth_values: np.ndarray,
    min_valid_depth: float = 0.1,
    max_valid_depth: float = 10000.0,
) -&gt; np.ndarray:
    &#34;&#34;&#34;
    Filter out invalid depth values from the depth array.

    Args:
        depth_values: Array of depth values
        min_valid_depth: Minimum valid depth value
        max_valid_depth: Maximum valid depth value

    Returns:
        Filtered array of valid depth values
    &#34;&#34;&#34;
    # Remove NaN and infinite values
    valid_mask = np.isfinite(depth_values)

    # Remove values outside reasonable depth range
    valid_mask &amp;= (depth_values &gt;= min_valid_depth) &amp; (depth_values &lt;= max_valid_depth)

    return depth_values[valid_mask]
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-0" id="node-58">
        <div class="call-header" onclick="toggleCall(58)">
            <span class="toggle-icon" id="icon-58">‚ñ∂</span>
            
        <span class="function-name">return estimate_height_in_cm_from_depth_map_height(box_height_in_depth_map_terms)</span>
    
            
        <span class="file-info">[utils.py:58-60]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-58" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-58" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(58)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(58)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-58"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-58" oninput="previewComment(58)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">depth_map_height:</span> <span style="color: rgb(0, 86, 179);">295.25</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">26.5922</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(58)">Show/Hide</button>
                <div class="source-container" id="source-58">
                    <pre class="language-python" tabindex="0"><code class="language-python">def estimate_height_in_cm_from_depth_map_height(depth_map_height: float) -&gt; float:
    &#34;&#34;&#34;Estimate height in cm from depth_map_height map height.

    Args:
        depth_map_height: a &#34;height&#34; (approximately mm) from depth map values.

    Returns:
        Estimated height value.
    &#34;&#34;&#34;
    depth_map_height = max(depth_map_height, 0.0)
    # The &#34;correct&#34; equestion is 0.1 * depth_map_height
    # (Luxonis promises Depth is in mm)
    # But depth maps aren&#39;t perfect,
    # our mask isn&#39;t perfect,
    # and we may encounter flaps.
    # So in addition to taking the 20th percentile depth of the box
    # when calculating its height, we also use a slightly adjusted equation.

    # Source: https://colab.research.google.com/drive/1ClJVYHmJMprJYyjY17GVSHZGw4_ZKbSj#scrollTo=f_uMbYVytsRB
    return 0.0900 * depth_map_height + 0.0197
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-5" id="node-61">
        <div class="call-header" onclick="toggleCall(61)">
            <span class="toggle-icon" id="icon-61">‚ñ∂</span>
            
        <span class="function-name">dimensions = calculate_dimensions_from_polygon(polygon_coordinates, image_height, image_width, box_height_cm, device_id)</span>
    
            
        <span class="file-info">[utils.py:176-178]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-61" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-61" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(61)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(61)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-61"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-61" oninput="previewComment(61)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">polygon_coordinates:</span> <span style="color: rgb(0, 86, 179);">[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]</span></div>
            
                <div><span style="color: #505050;">image_height:</span> <span style="color: rgb(0, 86, 179);">1080</span></div>
            
                <div><span style="color: #505050;">image_width:</span> <span style="color: rgb(0, 86, 179);">1920</span></div>
            
                <div><span style="color: #505050;">box_height_cm:</span> <span style="color: rgb(0, 86, 179);">26.5922</span></div>
            
                <div><span style="color: #505050;">device_id:</span> <span style="color: rgb(0, 86, 179);">&#x27;SCN-011&#x27;</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">{&#x27;box_length_cm&#x27;: 25.671628909271057, &#x27;box_width_cm&#x27;: 28.960996182914716, &#x27;box_height_cm&#x27;: 26.5922}</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(61)">Show/Hide</button>
                <div class="source-container" id="source-61">
                    <pre class="language-python" tabindex="0"><code class="language-python">def calculate_dimensions_from_polygon(
    polygon_coordinates: List[Tuple[float, float]],
    image_height: int,
    image_width: int,
    box_height_cm: Optional[float],
    device_id: str,
) -&gt; Dict:
    &#34;&#34;&#34;Calculate box dimensions from polygon coordinates and device parameters.

    Args:
        polygon_coordinates: List of polygon coordinate tuples.
        image_height: Height of the image in pixels.
        image_width: Width of the image in pixels.
        box_height_cm: Height of the box in centimeters.
        device_id: Device identifier for calibration parameters.

    Returns:
        Dictionary containing box dimensions in centimeters.
    &#34;&#34;&#34;
    min_rect, rect_length_px, rect_width_px, angle = calculate_min_area_rect(
        polygon_coordinates, image_height, image_width
    )

    box_dimensions_at_top = estimate_box_dimensions_at_top_face(
        rect_length_px,
        rect_width_px,
        box_height_cm,
        device_id=device_id,
        device_params=consts.SITE_DIMENSION_DATA,
    )

    length = box_dimensions_at_top[&#34;box_length_cm&#34;]
    width = box_dimensions_at_top[&#34;box_width_cm&#34;]
    height = box_height_cm or min(length, width)

    return {
        &#34;box_length_cm&#34;: length,
        &#34;box_width_cm&#34;: width,
        &#34;box_height_cm&#34;: height,
    }
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-0" id="node-62">
        <div class="call-header" onclick="toggleCall(62)">
            <span class="toggle-icon" id="icon-62">‚ñ∂</span>
            
        <span class="function-name">min_rect, rect_length_px, rect_width_px, angle = calculate_min_area_rect(polygon_coordinates, image_height, image_width)</span>
    
            
        <span class="file-info">[segmentation_ops.py:124-126]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-62" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-62" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(62)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(62)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-62"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-62" oninput="previewComment(62)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">normalized_polygon_coordinates:</span> <span style="color: rgb(0, 86, 179);">[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]</span></div>
            
                <div><span style="color: #505050;">image_height:</span> <span style="color: rgb(0, 86, 179);">1080</span></div>
            
                <div><span style="color: #505050;">image_width:</span> <span style="color: rgb(0, 86, 179);">1920</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">(((1093.64404296875, 572.4718017578125), (430.2251281738281, 400.96630859375), 28.024499893188477), 400.96630859375, 430.2251281738281, 118.02449989318848)</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(62)">Show/Hide</button>
                <div class="source-container" id="source-62">
                    <pre class="language-python" tabindex="0"><code class="language-python">def calculate_min_area_rect(
    normalized_polygon_coordinates: List[Tuple[float, float]],
    image_height: int,
    image_width: int,
) -&gt; Tuple[Tuple, float, float, float]:
    &#34;&#34;&#34;Calculate the minimum area rectangle for a polygon.

    Args:
        normalized_polygon_coordinates: List of (x, y) normalized coordinates
        image_height: The height of the image
        image_width: The width of the image

    Returns:
        Tuple containing:
        - rect: The minimum area rectangle (center, (width, height), angle)
        - width: The width of the rectangle (shorter dimension)
        - length: The length of the rectangle (longer dimension)
        - angle: The orientation angle in degrees
    &#34;&#34;&#34;
    # Convert normalized coordinates to pixel coordinates
    points = np.array(
        denormalize_polygon_coordinates(
            normalized_polygon_coordinates,
            image_height,
            image_width,
        )
    )

    # Find the minimum area rectangle using OpenCV
    rect = cv2.minAreaRect(points)

    # Get the width and height (rect[1] contains (width, height))
    width, height = rect[1]

    # Return with length as the longer dimension and width as the shorter one
    if width &lt;= height:
        return rect, width, height, rect[2]
    else:
        return rect, height, width, rect[2] + 90
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
            <div class="call-children">
                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-1" id="node-63">
        <div class="call-header" onclick="toggleCall(63)">
            <span class="toggle-icon" id="icon-63">‚ñ∂</span>
            
        <span class="function-name">points = np.array(denormalize_polygon_coordinates(normalized_polygon_coordinates,
            image_height,
            image_width))</span>
    
            
        <span class="file-info">[segmentation_ops.py:95-101]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-63" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-63" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(63)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(63)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-63"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-63" oninput="previewComment(63)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">normalized_polygon_coordinates:</span> <span style="color: rgb(0, 86, 179);">[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]</span></div>
            
                <div><span style="color: #505050;">image_height:</span> <span style="color: rgb(0, 86, 179);">1080</span></div>
            
                <div><span style="color: #505050;">image_width:</span> <span style="color: rgb(0, 86, 179);">1920</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">[(1046, 320), (1313, 478), (1361, 512), (1361, 528), (1196, 838), (1179, 838), (822, 655), (822, 625), (996, 320)]</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(63)">Show/Hide</button>
                <div class="source-container" id="source-63">
                    <pre class="language-python" tabindex="0"><code class="language-python">def denormalize_polygon_coordinates(
    normalized_polygon_coordinates: Optional[List[Tuple[float, float]]],
    image_height: int,
    image_width: int,
) -&gt; Optional[List[Tuple[int, int]]]:
    &#34;&#34;&#34;Convert normalized polygon coordinates to pixel coordinates.

    Args:
        normalized_polygon_coordinates: List of (x, y) normalized coordinates
            (or NaN value)
        image_height: height in pixels
        image_width: width in pixels

    Returns:
        List of (x, y) pixel coordinates
    &#34;&#34;&#34;
    if not isinstance(normalized_polygon_coordinates, list):
        return None
    return [
        (int(x * image_width), int(y * image_height))
        for x, y in normalized_polygon_coordinates
    ]
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-0" id="node-66">
        <div class="call-header" onclick="toggleCall(66)">
            <span class="toggle-icon" id="icon-66">‚ñ∂</span>
            
        <span class="function-name">box_dimensions_at_top = estimate_box_dimensions_at_top_face(rect_length_px,
        rect_width_px,
        box_height_cm,
        device_id=device_id,
        device_params=consts.SITE_DIMENSION_DATA)</span>
    
            
        <span class="file-info">[utils.py:128-134]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-66" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-66" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(66)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(66)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-66"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-66" oninput="previewComment(66)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">box_top_length_px:</span> <span style="color: rgb(0, 86, 179);">400.96630859375</span></div>
            
                <div><span style="color: #505050;">box_top_width_px:</span> <span style="color: rgb(0, 86, 179);">430.2251281738281</span></div>
            
                <div><span style="color: #505050;">box_height_cm:</span> <span style="color: rgb(0, 86, 179);">26.5922</span></div>
            
                <div><span style="color: #505050;">device_id:</span> <span style="color: rgb(0, 86, 179);">&#x27;SCN-011&#x27;</span></div>
            
                <div><span style="color: #505050;">device_params:</span> <span style="color: rgb(0, 86, 179);">{&#x27;SCN-009&#x27;: {&#x27;site&#x27;: &#x27;YVR2&#x27;, &#x27;device_id&#x27;: &#x27;SCN-009&#x27;, &#x27;camera_fov_y_degrees&#x27;: 38.0, &#x27;belt_width_px&#x27;: 942.2, &#x27;camera_height&#x27;: 124.46, &#x27;belt_width&#x27;: 76.2, &#x27;cm_per_pixel_y&#x27;: 0.0793611384259847, &#x27;cm_per_pixel_x&#x27;: 0.08087454892804076}, &#x27;SCN-010&#x27;: {&#x27;site&#x27;: &#x27;YVR3&#x27;, &#x27;device_id&#x27;: &#x27;SCN-010&#x27;, &#x27;camera_fov_y_degrees&#x27;: 38.0, &#x27;belt_width_px&#x27;: 1575, &#x27;camera_height&#x27;: 106.68, &#x27;belt_width&#x27;: 106.68, &#x27;cm_per_pixel_y&#x27;: 0.06802383293655832, &#x27;cm_per_pixel_x&#x27;: 0.06773333333333334}, &#x27;SCN-011&#x27;: {&#x27;site&#x27;: &#x27;YVR4&#x27;, &#x27;device_id&#x27;: &#x27;SCN-011&#x27;, &#x27;camera_fov_y_degrees&#x27;: 38.0, &#x27;belt_width_px&#x27;: 1312.6, &#x27;camera_height&#x27;: 127.0, &#x27;belt_width&#x27;: 111.76, &#x27;cm_per_pixel_y&#x27;: 0.08098075349590277, &#x27;cm_per_pixel_x&#x27;: 0.0851439890294073}, &#x27;SCN-012&#x27;: {&#x27;site&#x27;: &#x27;YXX2&#x27;, &#x27;device_id&#x27;: &#x27;SCN-012&#x27;, &#x27;camera_fov_y_degrees&#x27;: 38.0, &#x27;belt_width_px&#x27;: 1455.8, &#x27;camera_height&#x27;: 111.76, &#x27;belt_width&#x27;: 101.6, &#x27;cm_per_pixel_y&#x27;: 0.07126306307639443, &#x27;cm_per_pixel_x&#x27;: 0.06978980629207308}, &#x27;SCN-109&#x27;: {&#x27;site&#x27;: &#x27;YVR2&#x27;, &#x27;device_id&#x27;: &#x27;SCN-009&#x27;, &#x27;camera_fov_y_degrees&#x27;: 38.0, &#x27;belt_width_px&#x27;: 942.2, &#x27;camera_height&#x27;: 124.46, &#x27;belt_width&#x27;: 76.2, &#x27;cm_per_pixel_y&#x27;: 0.0793611384259847, &#x27;cm_per_pixel_x&#x27;: 0.08087454892804076}, &#x27;SCN-410&#x27;: {&#x27;site&#x27;: &#x27;YVR3&#x27;, &#x27;device_id&#x27;: &#x27;SCN-010&#x27;, &#x27;camera_fov_y_degrees&#x27;: 38.0, &#x27;belt_width_px&#x27;: 1575, &#x27;camera_height&#x27;: 106.68, &#x27;belt_width&#x27;: 106.68, &#x27;cm_per_pixel_y&#x27;: 0.06802383293655832, &#x27;cm_per_pixel_x&#x27;: 0.06773333333333334}, &#x27;SCN-312&#x27;: {&#x27;site&#x27;: &#x27;YXX2&#x27;, &#x27;device_id&#x27;: &#x27;SCN-012&#x27;, &#x27;camera_fov_y_degrees&#x27;: 38.0, &#x27;belt_width_px&#x27;: 1455.8, &#x27;camera_height&#x27;: 111.76, &#x27;belt_width&#x27;: 101.6, &#x27;cm_per_pixel_y&#x27;: 0.07126306307639443, &#x27;cm_per_pixel_x&#x27;: 0.06978980629207308}}</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">{&#x27;box_length_cm&#x27;: 25.671628909271057, &#x27;box_width_cm&#x27;: 28.960996182914716}</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(66)">Show/Hide</button>
                <div class="source-container" id="source-66">
                    <pre class="language-python" tabindex="0"><code class="language-python">def estimate_box_dimensions_at_top_face(
    box_top_length_px: float,
    box_top_width_px: float,
    box_height_cm: Optional[float],
    device_id: str,
    device_params: Dict[str, Dict],
) -&gt; Dict[str, float]:
    &#34;&#34;&#34;
    Estimate box top face CM dimensions from pixel dimensions.

    Since a taller box is closer to the camera, take height into account.
    As the distance between the box face and the camera goes to zero,
    the pixels/cm increases proportionally.

    Args:
        box_top_length_px (float): Box length in pixels (belt direction).
        box_top_width_px (float): Box width in pixels (across belt).
        box_height_cm (float): Height of the box above the belt in cm.
        device_id (str): ID of the camera device.
        device_params (Dict[str, Dict]): Dictionary of device calibration data.

    Returns:
        Dict[str, float]: {&#39;box_length_cm&#39;, &#39;box_width_cm&#39;} corrected for
            top-face proximity.
    &#34;&#34;&#34;
    device = device_params[device_id]
    camera_height_cm = device[&#34;camera_height&#34;]
    # if the depth map is not available, we have to guess
    box_height_cm = box_height_cm or 20
    box_face_depth = camera_height_cm - box_height_cm

    scale_factor = box_face_depth / camera_height_cm
    cm_per_pixel_y_top = device[&#34;cm_per_pixel_y&#34;] * scale_factor
    cm_per_pixel_x_top = device[&#34;cm_per_pixel_x&#34;] * scale_factor

    return {
        &#34;box_length_cm&#34;: box_top_length_px * cm_per_pixel_y_top,
        &#34;box_width_cm&#34;: box_top_width_px * cm_per_pixel_x_top,
    }
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-3" id="node-71">
        <div class="call-header" onclick="toggleCall(71)">
            <span class="toggle-icon" id="icon-71">‚ñ∂</span>
            
        <span class="function-name">result_df = utils.compute_surface_area_and_bbox_area(cardboard_box_df,
        surface_area_features)</span>
    
            
        <span class="file-info">[utils.py:131-134]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-71" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-71" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(71)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(71)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-71"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-71" oninput="previewComment(71)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">df:</span> <span style="color: rgb(0, 86, 179);">DataFrame (1√ó11) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_45.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_45"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_45')">
                             </div></span></div>
            
                <div><span style="color: #505050;">weight_features:</span> <span style="color: rgb(0, 86, 179);">{&#x27;box_length_cm&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: 25.671628909271057}, &#x27;box_width_cm&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: 28.960996182914716}, &#x27;box_height_cm&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: 26.5922}, &#x27;device_id&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: &#x27;SCN-011&#x27;}, &#x27;polygon_coordinates&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: [(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]}, &#x27;has_depth_map&#x27;: {&#x27;be2b443a-373a-4f53-85ea-4109f113c245&#x27;: True}}</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">DataFrame (1√ó19) - Showing all rows:<br><pre style='background:#f1f1f1; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:11px; overflow-x: auto;'>image_name,xmin,ymin,xmax,ymax,score,class_name,image_width,image_height,area,id,box_length_cm,box_width_cm,box_height_cm,device_id,polygon_coordinates,has_depth_map,surface_area,bbox_area
s3://scanner-data.us-west-2/SCN-011/2025/07/01/15/36/32-102661_0.jpg,0.43,0.16,0.75,0.79,0.96,CARDBOARD,1920,1080,0.2,be2b443a-373a-4f53-85ea-4109f113c245,25.67,28.96,26.59,SCN-011,&quot;[(0.5447916666666667, 0.2962962962962963), (0.6838541666666667, 0.4425925925925926), (0.7088541666666667, 0.4740740740740741), (0.7088541666666667, 0.4888888888888889), (0.6229166666666667, 0.7759259259259259), (0.6140625, 0.7759259259259259), (0.428125, 0.6064814814814815), (0.428125, 0.5787037037037037), (0.51875, 0.2962962962962963)]&quot;,True,4392.56,0.2
</pre><br><strong>Annotated Image:</strong><br><div style="display: flex; flex-direction: column;">
                                 <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #495057;">numpy.ndarray((1080, 1920, 3), uint8)</div>
                                 <img src="images/img_46.png"
                                      alt="NumPy array visualization"
                                      title="numpy.ndarray((1080, 1920, 3), uint8)"
                                      class="trace-image"
                                      id="trace-img-img_46"
                                      data-expanded="false"
                                      onclick="toggleImageSize('img_46')">
                             </div></div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(71)">Show/Hide</button>
                <div class="source-container" id="source-71">
                    <pre class="language-python" tabindex="0"><code class="language-python">def compute_surface_area_and_bbox_area(
    df: pd.DataFrame,
    weight_features: Dict,
) -&gt; pd.DataFrame:
    &#34;&#34;&#34;Compute surface area and bounding box area from features.

    Args:
        df: Input DataFrame containing detection data.
        weight_features: Dictionary of weight features to add to DataFrame.

    Returns:
        DataFrame with added surface area and bounding box area columns.
    &#34;&#34;&#34;
    result_df = df.copy()

    for feature, value_map in weight_features.items():
        result_df[feature] = result_df.id.map(value_map)

    L = result_df[&#34;box_length_cm&#34;]
    W = result_df[&#34;box_width_cm&#34;]
    H = result_df[&#34;box_height_cm&#34;]
    ymin = result_df[&#34;ymin&#34;]
    xmin = result_df[&#34;xmin&#34;]
    ymax = result_df[&#34;ymax&#34;]
    xmax = result_df[&#34;xmax&#34;]

    result_df[&#34;surface_area&#34;] = 2 * (L * W + L * H + W * H)
    result_df[&#34;bbox_area&#34;] = (ymax - ymin) * (xmax - xmin)

    return result_df
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
                    
    
    
    
    
    
    
    
    
    
    
    
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    <div class="call-node depth-2" id="node-74">
        <div class="call-header" onclick="toggleCall(74)">
            <span class="toggle-icon" id="icon-74">‚ñ∂</span>
            
        <span class="function-name">result_df[&#34;weight&#34;] = result_df.apply(lambda row: utils.estimate_weight_from_surface_area(row.device_id, row.surface_area),
            axis=&#34;columns&#34;)</span>
    
            
        <span class="file-info">[utils.py:46-51]</span>
    
            
        <span class="thread-info">Thread: 133720079963840</span>
    
        </div>
        <div class="call-content" id="content-74" data-expanded="false">
            <div class="call-info">
                
        <div class="comment-section" id="comment-section-74" data-editing="false">
            <div class="comment-header">
                <div class="section-title">Comment</div>
                <button class="comment-toggle-edit-btn" onclick="enterCommentEditMode(74)">
                    Add Comment
                </button>
                <button class="comment-save-btn" onclick="saveAndExitCommentEditMode(74)">Save</button>
            </div>
            <div class="comment-content">
                <div class="comment-output" id="comment-output-74"></div>
                <div class="comment-edit-controls">
                    <textarea class="comment-input" id="comment-input-74" oninput="previewComment(74)"
                            placeholder="Type your comment here. Markdown is supported."></textarea>
                </div>
            </div>
        </div>
    
                <div class="args-section">
                    <div class="section-title">Arguments:</div>
                    <div class="args-list">
        
            
                <div><span style="color: #505050;">scanner_id:</span> <span style="color: rgb(0, 86, 179);">&#x27;SCN-011&#x27;</span></div>
            
                <div><span style="color: #505050;">surface_area:</span> <span style="color: rgb(0, 86, 179);">4392.555279654049</span></div>
            
        
    </div>
                </div>
                
        
            <div class="return-section">
                <div class="section-title">Return Value:</div>
                <div class="return-value">325.3363279464092</div>
            </div>
        
    
                
        
            <div class="source-section">
                <div class="section-title">Source Code</div>
                <button class="source-toggle" onclick="toggleSource(74)">Show/Hide</button>
                <div class="source-container" id="source-74">
                    <pre class="language-python" tabindex="0"><code class="language-python">def estimate_weight_from_surface_area(scanner_id: str, surface_area: float) -&gt; float:
    &#34;&#34;&#34;Estimate weight from surface area using device-specific coefficients.

    Args:
        scanner_id: Scanner device identifier.
        surface_area: Calculated surface area value.

    Returns:
        Estimated weight value, or NaN if scanner_id is invalid.
    &#34;&#34;&#34;
    if not scanner_id:
        return pd.NA
    coefficients = consts.SURFACE_AREA_COEFFICIENTS[scanner_id]
    slope = coefficients[&#34;slope&#34;]
    intercept = coefficients[&#34;intercept&#34;]
    return slope * surface_area + intercept
</code></pre>
                </div>
            </div>
        
    
            </div>
            
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

                
            </div>
        
    
        </div>
    </div>

            
        
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
    (function() {
        if (!window.sessionStorage || !window.marked) {
            console.warn("Tracer features like state persistence or Markdown comments may not work.");
            return;
        }

        const requestId = document.body.dataset.requestId;
        const stateKey = `traceState_${requestId}`;

        function getTraceState() {
            try {
                const storedState = sessionStorage.getItem(stateKey);
                return storedState ? JSON.parse(storedState) : {};
            } catch (e) {
                console.error("Could not read trace state from sessionStorage", e);
                return {};
            }
        }

        function saveTraceState(state) {
            try {
                sessionStorage.setItem(stateKey, JSON.stringify(state));
            } catch (e) {
                console.error("Could not save trace state to sessionStorage", e);
            }
        }

        function updateNodeState(id, key, value) {
            const state = getTraceState();
            if (!state[id]) state[id] = {};
            state[id][key] = value;
            saveTraceState(state);
        }

        function updateImageState(id, key, value) {
            const state = getTraceState();
            const imageKey = `image_${id}`;
            if (!state[imageKey]) state[imageKey] = {};
            state[imageKey][key] = value;
            saveTraceState(state);
        }

        // Set the visual state of a call node without triggering save
        function setCallState(id, expanded) {
            const content = document.getElementById(`content-${id}`);
            const icon = document.getElementById(`icon-${id}`);
            if (!content || !icon) {
                console.warn(`Could not find elements for call ${id}`);
                return false;
            }

            if (expanded) {
                content.classList.add('show');
                icon.textContent = '‚ñº';
                content.dataset.expanded = 'true';
            } else {
                content.classList.remove('show');
                icon.textContent = '‚ñ∂';
                content.dataset.expanded = 'false';
            }
            return true;
        }

        window.toggleCall = function(id) {
            const content = document.getElementById(`content-${id}`);
            const icon = document.getElementById(`icon-${id}`);
            if (!content || !icon) return;

            const isVisible = content.classList.toggle('show');
            icon.textContent = isVisible ? '‚ñº' : '‚ñ∂';
            content.dataset.expanded = isVisible ? 'true' : 'false';
            updateNodeState(id, 'expanded', isVisible);
        };

        window.toggleImageSize = function(id) {
            const img = document.getElementById(`trace-img-${id}`);
            if (!img) return;

            const isExpanded = img.dataset.expanded === 'true' ? 'false' : 'true';
            img.dataset.expanded = isExpanded;
            
            updateImageState(id, 'expanded', isExpanded === 'true');
        };

        window.toggleSource = function(id) {
            const container = document.getElementById(`source-${id}`);
            if (!container) return;

            const isVisible = container.style.display === 'block';
            const newVisibility = !isVisible;
            container.style.display = newVisibility ? 'block' : 'none';
            container.dataset.sourceVisible = newVisibility ? 'true' : 'false';
            updateNodeState(id, 'sourceVisible', newVisibility);
        };
        
        window.previewComment = function(id) {
            const input = document.getElementById(`comment-input-${id}`);
            const output = document.getElementById(`comment-output-${id}`);
            if (!input || !output) return;
            output.innerHTML = marked.parse(input.value);
            if (window.Prism) {
                Prism.highlightAllUnder(output);
            }
        };

        window.enterCommentEditMode = function(id) {
            const section = document.getElementById(`comment-section-${id}`);
            if (!section) return;
            section.dataset.editing = 'true';
            const input = section.querySelector('.comment-input');
            if (input) input.focus();
        };
        
        window.saveAndExitCommentEditMode = function(id) {
            const section = document.getElementById(`comment-section-${id}`);
            const input = document.getElementById(`comment-input-${id}`);
            const button = section.querySelector('.comment-toggle-edit-btn');
            if (!section || !input || !button) return;
            
            section.dataset.editing = 'false';
            const markdownText = input.value;
            input.dataset.comment = markdownText;
            updateNodeState(id, 'comment', markdownText);
            button.textContent = markdownText ? 'Edit Comment' : 'Add Comment';
            
            // Update the preview
            window.previewComment(id);
        };

        window.exportFullHTML = function() {
            const filename = `trace_${requestId}_${new Date().toISOString().slice(0,19).replace('T','_').replace(/:/g,'-')}.html`;
            const clonedDoc = document.documentElement.cloneNode(true);
            const state = getTraceState();

            // Apply state to the cloned document
            Object.keys(state).forEach(id => {
                if (id.startsWith('image_')) {
                    const imageId = id.replace('image_', '');
                    const imageState = state[id];
                    const img = clonedDoc.querySelector(`#trace-img-${imageId}`);
                    
                    if (img && imageState.expanded !== undefined) {
                        img.dataset.expanded = imageState.expanded ? 'true' : 'false';
                    }
                } else {
                    const nodeState = state[id];
                    const contentEl = clonedDoc.querySelector(`#content-${id}`);
                    const iconEl = clonedDoc.querySelector(`#icon-${id}`);
                    const sourceEl = clonedDoc.querySelector(`#source-${id}`);
                    const inputEl = clonedDoc.querySelector(`#comment-input-${id}`);
                    const outputEl = clonedDoc.querySelector(`#comment-output-${id}`);
                    const buttonEl = clonedDoc.querySelector(`#comment-section-${id} .comment-toggle-edit-btn`);

                    // Apply expansion state
                    if (contentEl && nodeState.expanded !== undefined) {
                        contentEl.dataset.expanded = nodeState.expanded ? 'true' : 'false';
                        if (nodeState.expanded) {
                            contentEl.classList.add('show');
                            if (iconEl) iconEl.textContent = '‚ñº';
                        } else {
                            contentEl.classList.remove('show');
                            if (iconEl) iconEl.textContent = '‚ñ∂';
                        }
                    }

                    // Apply source visibility
                    if (sourceEl && nodeState.sourceVisible !== undefined) {
                        sourceEl.style.display = nodeState.sourceVisible ? 'block' : 'none';
                        sourceEl.dataset.sourceVisible = nodeState.sourceVisible ? 'true' : 'false';
                    }

                    // Apply comment state
                    if (nodeState.comment !== undefined) {
                        if (inputEl) {
                            inputEl.value = nodeState.comment;
                            inputEl.dataset.comment = nodeState.comment;
                        }
                        if (outputEl && window.marked) {
                            outputEl.innerHTML = marked.parse(nodeState.comment);
                        }
                        if (buttonEl) {
                            buttonEl.textContent = nodeState.comment ? 'Edit Comment' : 'Add Comment';
                        }
                    }
                }
            });

            const htmlContent = '<!DOCTYPE html>\n' + clonedDoc.outerHTML;
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };

        function loadInitialState() {
            const state = getTraceState();
            console.log('Loading initial state:', state);
            
            Object.keys(state).forEach(id => {
                if (id.startsWith('image_')) {
                    const imageId = id.replace('image_', '');
                    const imageState = state[id];
                    const img = document.getElementById(`trace-img-${imageId}`);
                    
                    if (img && imageState.expanded !== undefined) {
                        img.dataset.expanded = imageState.expanded ? 'true' : 'false';
                    }
                } else {
                    const nodeState = state[id];
                    console.log(`Restoring state for node ${id}:`, nodeState);
                    
                    // Restore expansion state
                    if (nodeState.expanded !== undefined) {
                        const success = setCallState(id, nodeState.expanded);
                        if (!success) {
                            console.warn(`Failed to restore expansion state for node ${id}`);
                        }
                    }

                    // Restore source visibility
                    if (nodeState.sourceVisible !== undefined) {
                        const container = document.getElementById(`source-${id}`);
                        if (container) {
                            container.style.display = nodeState.sourceVisible ? 'block' : 'none';
                            container.dataset.sourceVisible = nodeState.sourceVisible ? 'true' : 'false';
                        }
                    }

                    // Restore comment state
                    if (nodeState.comment !== undefined) {
                        const section = document.getElementById(`comment-section-${id}`);
                        if (section) {
                            const input = section.querySelector(`#comment-input-${id}`);
                            const output = section.querySelector(`#comment-output-${id}`);
                            const button = section.querySelector('.comment-toggle-edit-btn');
                            
                            if (input) {
                                input.value = nodeState.comment;
                                input.dataset.comment = nodeState.comment;
                            }
                            
                            if (output && window.marked) {
                                output.innerHTML = marked.parse(nodeState.comment);
                                if (window.Prism) { 
                                    Prism.highlightAllUnder(output); 
                                }
                            }
                            
                            if (button) {
                                button.textContent = nodeState.comment ? 'Edit Comment' : 'Add Comment';
                            }
                        }
                    }
                }
            });
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                loadInitialState();
                if (window.Prism) {
                    Prism.highlightAll();
                }
            });
        } else {
            // DOM is already ready
            loadInitialState();
            if (window.Prism) {
                Prism.highlightAll();
            }
        }
    })();
    </script>
</body>
</html>